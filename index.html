<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bee Store - å­¦ç”Ÿä½œå“å±•ç¤ºå¹³å°</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3E%3Ctext y='14' font-size='14'%3EğŸ%3C/text%3E%3C/svg%3E" />
    <script src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1002;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .status-connected { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-syncing { background: #ff9500; color: white; }

        /* å¤´éƒ¨æ ·å¼ */
        .header {
            background: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid #f0f0f0;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ff9500;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff9500, #ff6600);
            color: white;
        }

        .btn-secondary {
            background: #ffffff;
            color: #ff9500;
            border: 1px solid #ff9500;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .main-content {
            padding: 1rem 0; /* å‡å°‘é¡¶éƒ¨padding */
        }



        /* å¤´éƒ¨æ•´åˆå¸ƒå±€ */
        .header-integrated {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem; /* å‡å°‘é—´è· */
        }

        /* æ¡Œé¢ç«¯å¸ƒå±€ */
        .desktop-layout {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
        }

        /* ç§»åŠ¨ç«¯å¸ƒå±€é»˜è®¤éšè— */
        .mobile-layout {
            display: none;
        }

        .header-slogan {
            flex: 0 0 auto;
            font-size: 1.1rem;
            font-weight: 600;
            color: #ff9500;
            white-space: nowrap;
        }

        .header-search {
            flex: 1;
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .search-btn {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            padding: 0;
            flex-shrink: 0;
            background: transparent !important;
            color: #ff9500 !important;
            border: none;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: rgba(255, 149, 0, 0.1) !important;
            transform: none;
            box-shadow: none;
        }

        .header-search .search-input {
            height: 40px;
            padding: 0 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            margin-bottom: 0;
            flex: 1;
        }

        .header-search .search-input:focus {
            outline: none;
            border-color: #ff9500;
        }

        .header-search .filter-select {
            height: 40px;
            padding: 0 0.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.9rem;
            box-sizing: border-box;
            background: white;
        }

        .header-search .filter-select:focus {
            outline: none;
            border-color: #ff9500;
        }

        /* è‡ªå®šä¹‰ä¸‹æ‹‰èœå•æ ·å¼ */
        .custom-dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-trigger {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            background: transparent;
            color: #ff9500;
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .dropdown-trigger:hover {
            background: rgba(255, 149, 0, 0.1);
        }

        .dropdown-trigger.active {
            background: rgba(255, 149, 0, 0.15);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            min-width: 120px;
            max-height: 250px;
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
        }

        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-item {
            padding: 0.6rem 0.8rem;
            cursor: pointer;
            font-size: 0.9rem;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s ease;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: rgba(255, 149, 0, 0.1);
        }

        .dropdown-item.selected {
            background: rgba(255, 149, 0, 0.2);
            color: #ff6600;
            font-weight: 500;
        }

        .header-stats {
            flex: 0 0 auto;
            display: flex;
            gap: 1.5rem;
            font-size: 0.9rem;
        }

        .stat-compact {
            text-align: center;
            color: #333;
        }

        .stat-compact .number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff9500;
            display: block;
        }

        .stat-compact .label {
            font-size: 0.8rem;
            color: #666;
        }

        /* åº”ç”¨ç½‘æ ¼ */
        .apps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem; /* å‡å°‘é—´è· */
            margin-top: 0; /* ç§»é™¤é¡¶éƒ¨é—´è· */
        }

        .app-card {
            background: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            position: relative;
        }

        .app-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 149, 0, 0.15);
            border-color: #ff9500;
        }

        .app-screenshot {
            width: 100%;
            height: 140px; /* å‡å°é«˜åº¦ */
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 0.9rem;
            overflow: hidden;
            position: relative;
        }

        .app-screenshot img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .app-screenshot .placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            text-align: center;
        }

        .app-info h3 {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
            color: #333;
        }

        /* äº§å“æè¿°å±•å¼€åŠŸèƒ½ */
        .app-description {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            line-height: 1.4;
            position: relative;
        }

        .app-description.collapsed {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            position: relative;
            cursor: pointer;
        }

        .app-description.collapsed.has-overflow::after {
            content: '...å±•å¼€';
            position: absolute;
            bottom: 0;
            right: 0;
            background: linear-gradient(to right, transparent, white 30%, white);
            color: #ff9500;
            font-size: 0.85rem;
            padding-left: 20px;
            text-decoration: underline;
            pointer-events: auto;
            z-index: 2;
        }

        .app-description.collapsed.has-overflow::after:hover {
            color: #ff6600;
        }

        .app-description.expanded {
            display: block;
        }

        .description-toggle {
            color: #ff9500;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            padding: 0;
            margin-top: 0.25rem;
            text-decoration: underline;
        }

        .description-toggle:hover {
            color: #ff6600;
        }

        .app-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            font-size: 0.8rem;
            color: #888;
        }

        .app-stats {
            display: flex;
            gap: 1rem;
        }

        .app-url {
            color: #ff6600;
            text-decoration: none;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0;
            margin-left: 0.5rem;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            background: rgba(255, 102, 0, 0.1);
            transition: all 0.3s ease;
            font-weight: 500;
            vertical-align: middle;
        }

        .app-url:hover {
            background: rgba(255, 102, 0, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(255, 102, 0, 0.2);
        }

        .app-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.5rem;
            z-index: 10;
        }

        .app-action-btn {
            background: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .app-action-btn:hover {
            background: #dc3545;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .app-action-btn.edit-btn {
            background: rgba(0, 123, 255, 0.9);
        }
        
        .app-action-btn.edit-btn:hover {
            background: #007bff;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ffffff;
            padding: 2rem;
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        /* æˆªå›¾æ–¹å¼è¡Œ */
        .capture-method-row {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin: 0.75rem 0 1rem;
        }

        .capture-method-row label {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: normal;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff9500, #ff6600);
            color: #fff;
            border: none;
        }

        .btn-primary:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 3px 12px rgba(255, 149, 0, 0.4);
        }

        .btn-secondary {
            border: 1px solid #ff9500;
            color: #ff9500;
            background: #fff;
        }

        .btn-secondary:hover {
            background: #ff9500;
            color: #fff;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #ff9500;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .btn-cancel {
            background: #f5f5f5;
            color: #666;
        }

        /* å‘å¸ƒåº”ç”¨æŒ‰é’® */
        .publish-btn {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff9500, #ff6600);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .publish-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(0, 0, 0, 0.3);
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #666;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #333;
        }

        .empty-state p {
            color: #666;
            font-size: 1.1rem;
        }

        /* ç”¨æˆ·ä¿¡æ¯ */
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: #333;
        }

        /* åº”ç”¨äº’åŠ¨æŒ‰é’® */
        .app-interactions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding: 0.75rem 0;
            border-top: 1px solid #f0f0f0;
        }

        .interaction-group {
            display: flex;
            gap: 1rem;
        }

        .interaction-btn {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.85rem;
            color: #666;
            transition: color 0.3s ease;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .interaction-btn:hover {
            color: #ff9500;
            background: rgba(255, 149, 0, 0.1);
        }

        .interaction-btn.active {
            color: #ff9500;
        }

        .interaction-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .interaction-btn:disabled:hover {
            color: #666;
            background: none;
        }

        /* è¯„è®ºåŒºåŸŸ */
        .comments-section {
            margin-top: 1rem;
            border-top: 1px solid #f0f0f0;
            padding-top: 1rem;
        }

        .comment-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            position: relative;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            color: #666;
        }

        .comment-author {
            font-weight: bold;
            color: #333;
        }

        .comment-content {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .comment-delete {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 0.8rem;
            padding: 0.25rem;
        }

        .comment-delete:hover {
            color: #c82333;
        }

        .comment-input {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .comment-input input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .comment-input button {
            padding: 0.5rem 1rem;
            background: #ff9500;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .comment-input button:hover {
            background: #ff6600;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ff9500, #ff6600);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            overflow: hidden;
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* æˆªå›¾é¢„è§ˆ */
        .screenshot-preview {
            width: 100%;
            height: 200px;
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            overflow: hidden;
        }

        .screenshot-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #ff9500;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* æœç´¢åŠŸèƒ½ */
        .search-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 0.5rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-section {
            background: linear-gradient(135deg, #ff9500 0%, #ff6600 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            color: white;
        }

        .stats-row {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-item p {
            opacity: 0.8;
        }

        /* æ±‰å ¡èœå•æ ·å¼ */
        .hamburger-menu {
            display: none;
            flex-direction: column;
            cursor: pointer;
            padding: 0.5rem;
            gap: 0.3rem;
        }

        .hamburger-line {
            width: 24px;
            height: 3px;
            background-color: #ff9500;
            border-radius: 2px;
            transition: all 0.3s ease;
        }

        .hamburger-menu.active .hamburger-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .hamburger-menu.active .hamburger-line:nth-child(2) {
            opacity: 0;
        }

        .hamburger-menu.active .hamburger-line:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        .mobile-nav-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .mobile-nav-overlay.active {
            opacity: 1;
        }

        .mobile-nav-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100%;
            background: white;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 2rem 1.5rem;
        }

        .mobile-nav-menu.active {
            right: 0;
        }

        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e9ecef;
        }

        .mobile-nav-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ff9500;
        }

        .mobile-nav-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #666;
            cursor: pointer;
            padding: 0.25rem;
        }

        .mobile-nav-items {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .mobile-nav-item {
            width: 100%;
            padding: 0.75rem 1rem;
            background: #f8f9fa;
            color: #333;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .mobile-nav-item:hover {
            background: #ff9500;
            color: white;
            border-color: #ff9500;
        }

        .mobile-user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1024px) {
            .apps-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 1rem;
            }
            
            .nav-buttons {
                display: none;
            }

            .nav {
                justify-content: center;
            }

            .logo {
                margin: 0 auto;
            }

            .hamburger-menu {
                display: flex;
            }

            /* å¤´éƒ¨æ•´åˆå“åº”å¼ */
            .header-integrated {
                padding: 0.75rem 1rem;
                margin-bottom: 1rem;
            }

            /* ç§»åŠ¨ç«¯ï¼šéšè—æ¡Œé¢å¸ƒå±€ï¼Œæ˜¾ç¤ºç§»åŠ¨å¸ƒå±€ */
            .desktop-layout {
                display: none;
            }

            .mobile-layout {
                display: block;
            }

            /* ç§»åŠ¨ç«¯ç¬¬ä¸€è¡Œï¼šæ ‡é¢˜å’Œæœç´¢æ¡† */
            .mobile-header-row {
                display: flex;
                align-items: flex-end;
                gap: 0.75rem;
                margin-bottom: 0.75rem;
                padding-top: 0.25rem;
            }

            .mobile-header-row .header-slogan {
                flex: 0 0 auto;
                font-size: 0.9rem;
                font-weight: 600;
                white-space: nowrap;
                line-height: 36px;
                align-self: center;
            }

            .mobile-header-row .search-input {
                flex: 1;
                min-width: 0;
                height: 36px;
                font-size: 0.9rem;
                padding: 0 0.5rem;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                box-sizing: border-box;
                margin-top: 0.25rem;
            }

            .mobile-header-row .search-input:focus {
                outline: none;
                border-color: #ff9500;
            }

            /* ç§»åŠ¨ç«¯ç¬¬äºŒè¡Œï¼šç­›é€‰å™¨å’Œæœç´¢æŒ‰é’® */
            .mobile-filters-row {
                display: flex;
                gap: 0.5rem;
                align-items: center;
            }

            .mobile-filters-row .filter-select {
                height: 36px;
                font-size: 0.85rem;
                flex: 1;
                padding: 0 0.5rem;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                box-sizing: border-box;
                background: white;
            }

            .mobile-filters-row .filter-select:focus {
                outline: none;
                border-color: #ff9500;
            }

            .mobile-filters-row .search-btn {
                width: 36px;
                height: 36px;
                font-size: 1rem;
                flex-shrink: 0;
            }

            /* ç§»åŠ¨ç«¯è‡ªå®šä¹‰ä¸‹æ‹‰èœå• */
            .mobile-filters-row .custom-dropdown {
                flex: 1;
            }

            .mobile-filters-row .dropdown-trigger {
                width: 100%;
                height: 36px;
                font-size: 1rem;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                background: white;
            }

            .mobile-filters-row .dropdown-trigger:hover {
                border-color: #ff9500;
                background: rgba(255, 149, 0, 0.05);
            }

            .mobile-filters-row .dropdown-trigger.active {
                border-color: #ff9500;
                background: rgba(255, 149, 0, 0.1);
            }

            .mobile-filters-row .dropdown-menu {
                min-width: 100%;
            }

            .interaction-group {
                gap: 0.5rem;
            }

            .interaction-btn {
                font-size: 0.8rem;
                padding: 0.2rem 0.4rem;
            }

            .comment-input {
                flex-direction: column;
                gap: 0.5rem;
            }

            .comment-input input {
                margin-bottom: 0;
            }



            .stats-row {
                flex-direction: column;
                gap: 1rem;
            }

            .logo {
                font-size: 1.5rem;
            }
        }
        @media (max-width: 768px) {
            .apps-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 95%;
                margin: 0;
                transform: translate(-50%, -50%);
            }

            body.no-scroll {
                overflow: hidden;
            }

            /* è¿›ä¸€æ­¥å‡å°‘ç§»åŠ¨ç«¯çš„é—´è· */
            .main-content {
                padding: 0.5rem 0;
            }

            .header-integrated {
                margin-bottom: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div id="status-indicator" class="status-indicator status-syncing">
        ğŸ æ­£åœ¨è¿æ¥åˆ° Bee Store
    </div>

    <div class="header">
        <div class="container">
            <nav class="nav">
                <a href="#" class="logo">
                    <span>ğŸ</span>
                    <span>Bee Store</span>
                </a>
                <div class="nav-buttons">
                    <div id="guest-nav" style="display: flex; gap: 1rem;">
                        <button class="btn btn-secondary" onclick="showLogin()">ç™»å½•</button>
                        <button class="btn btn-primary" onclick="showRegister()">æ³¨å†Œ</button>
                    </div>
                    <div id="user-nav" style="display: none; align-items: center; gap: 1rem;">
                        <div class="user-info">
                            <div class="user-avatar" id="user-avatar"></div>
                            <span id="user-name"></span>
                        </div>
                        <button class="btn btn-secondary" onclick="goHome()">é¦–é¡µ</button>
                        <button class="btn btn-secondary" onclick="showMyApps()">æˆ‘çš„åº”ç”¨</button>
                        <button class="btn btn-secondary" onclick="showMyFavorites()">æˆ‘çš„æ”¶è—</button>
                        <button class="btn btn-secondary" onclick="showLogViewer()" style="display: none;" id="log-viewer-btn">ğŸ“‹ æŸ¥çœ‹æ—¥å¿—</button>
                        <button class="btn btn-secondary" onclick="logout()">é€€å‡º</button>
                    </div>
                </div>
                
                <!-- æ±‰å ¡èœå•æŒ‰é’® -->
                <div class="hamburger-menu" id="hamburger-menu" onclick="toggleMobileMenu()">
                    <div class="hamburger-line"></div>
                    <div class="hamburger-line"></div>
                    <div class="hamburger-line"></div>
                </div>
            </nav>
        </div>
    </div>

    <div class="container">
        <div class="main-content">
            <!-- æ•´åˆçš„å¤´éƒ¨ï¼šsloganã€æœç´¢ã€ç»Ÿè®¡ -->
            <div class="header-integrated">
                <!-- æ¡Œé¢ç«¯å¸ƒå±€ -->
                <div class="desktop-layout">
                    
                    <div class="header-search">
                        <input type="text" class="search-input" id="search-input" placeholder="æœç´¢ä½œå“åç§°ã€æè¿°ã€åˆ›ä½œè€…...">
                        
                        <!-- åˆ†ç±»ä¸‹æ‹‰èœå• -->
                        <div class="custom-dropdown">
                            <button class="dropdown-trigger" id="category-trigger" onclick="toggleDropdown('category')" title="åˆ†ç±»ç­›é€‰">
                                ğŸ·ï¸
                            </button>
                            <div class="dropdown-menu" id="category-dropdown">
                                <div class="dropdown-item selected" data-value="">å…¨éƒ¨åˆ†ç±»</div>
                                <div class="dropdown-item" data-value="å·¥å…·">ğŸ”§ å·¥å…·</div>
                                <div class="dropdown-item" data-value="å­¦ä¹ ">ğŸ“š å­¦ä¹ </div>
                                <div class="dropdown-item" data-value="æ¸¸æˆ">ğŸ® æ¸¸æˆ</div>
                                <div class="dropdown-item" data-value="è‰ºæœ¯">ğŸ¨ è‰ºæœ¯</div>
                                <div class="dropdown-item" data-value="ç§‘æŠ€">ğŸ’» ç§‘æŠ€</div>
                            </div>
                        </div>
                        
                        <!-- æ’åºä¸‹æ‹‰èœå• -->
                        <div class="custom-dropdown">
                            <button class="dropdown-trigger" id="sort-trigger" onclick="toggleDropdown('sort')" title="æ’åºæ–¹å¼">
                                ğŸ“…
                            </button>
                            <div class="dropdown-menu" id="sort-dropdown">
                                <div class="dropdown-item selected" data-value="newest">ğŸ“… æœ€æ–°å‘å¸ƒ</div>
                                <div class="dropdown-item" data-value="oldest">ğŸ“… æœ€æ—©å‘å¸ƒ</div>
                                <div class="dropdown-item" data-value="name">ğŸ”¤ æŒ‰åç§°</div>
                                <div class="dropdown-item" data-value="author">ğŸ‘¤ æŒ‰ä½œè€…</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary search-btn" onclick="searchApps()">ğŸ”</button>
                        
                        <!-- éšè—çš„åŸå§‹selectå…ƒç´ ï¼Œç”¨äºä¿æŒåŠŸèƒ½ -->
                        <select class="filter-select" id="category-filter" style="display: none;">
                            <option value="">å…¨éƒ¨åˆ†ç±»</option>
                            <option value="å·¥å…·">å·¥å…·</option>
                            <option value="å­¦ä¹ ">å­¦ä¹ </option>
                            <option value="æ¸¸æˆ">æ¸¸æˆ</option>
                            <option value="è‰ºæœ¯">è‰ºæœ¯</option>
                            <option value="ç§‘æŠ€">ç§‘æŠ€</option>
                        </select>
                        <select class="filter-select" id="sort-filter" style="display: none;">
                            <option value="newest">æœ€æ–°å‘å¸ƒ</option>
                            <option value="oldest">æœ€æ—©å‘å¸ƒ</option>
                            <option value="name">æŒ‰åç§°</option>
                            <option value="author">æŒ‰ä½œè€…</option>
                        </select>
                    </div>
                    
                    <div class="header-stats">
                        <div class="stat-compact">
                            <span class="number" id="total-apps">0</span>
                            <span class="label">ä½œå“æ€»æ•°</span>
                        </div>
                        <div class="stat-compact">
                            <span class="number" id="total-users">0</span>
                            <span class="label">åˆ›ä½œè€…</span>
                        </div>
                    </div>
                </div>

                <!-- ç§»åŠ¨ç«¯å¸ƒå±€ -->
                <div class="mobile-layout">
                    <!-- ç¬¬ä¸€è¡Œï¼šæ ‡é¢˜å’Œæœç´¢æ¡† -->
                    <div class="mobile-header-row">
                        <input type="text" class="search-input" id="search-input-mobile" placeholder="æœç´¢ä½œå“...">
                    </div>
                    
                    <!-- ç¬¬äºŒè¡Œï¼šç­›é€‰å™¨å’Œæœç´¢æŒ‰é’® -->
                    <div class="mobile-filters-row">
                        <!-- ç§»åŠ¨ç«¯åˆ†ç±»ä¸‹æ‹‰èœå• -->
                        <div class="custom-dropdown">
                            <button class="dropdown-trigger" id="category-trigger-mobile" onclick="toggleDropdown('category-mobile')" title="åˆ†ç±»ç­›é€‰">
                                ğŸ·ï¸
                            </button>
                            <div class="dropdown-menu" id="category-dropdown-mobile">
                                <div class="dropdown-item selected" data-value="">å…¨éƒ¨åˆ†ç±»</div>
                                <div class="dropdown-item" data-value="å·¥å…·">ğŸ”§ å·¥å…·</div>
                                <div class="dropdown-item" data-value="å­¦ä¹ ">ğŸ“š å­¦ä¹ </div>
                                <div class="dropdown-item" data-value="æ¸¸æˆ">ğŸ® æ¸¸æˆ</div>
                                <div class="dropdown-item" data-value="è‰ºæœ¯">ğŸ¨ è‰ºæœ¯</div>
                                <div class="dropdown-item" data-value="ç§‘æŠ€">ğŸ’» ç§‘æŠ€</div>
                            </div>
                        </div>
                        
                        <!-- ç§»åŠ¨ç«¯æ’åºä¸‹æ‹‰èœå• -->
                        <div class="custom-dropdown">
                            <button class="dropdown-trigger" id="sort-trigger-mobile" onclick="toggleDropdown('sort-mobile')" title="æ’åºæ–¹å¼">
                                ğŸ“…
                            </button>
                            <div class="dropdown-menu" id="sort-dropdown-mobile">
                                <div class="dropdown-item selected" data-value="newest">ğŸ“… æœ€æ–°å‘å¸ƒ</div>
                                <div class="dropdown-item" data-value="oldest">ğŸ“… æœ€æ—©å‘å¸ƒ</div>
                                <div class="dropdown-item" data-value="name">ğŸ”¤ æŒ‰åç§°</div>
                                <div class="dropdown-item" data-value="author">ğŸ‘¤ æŒ‰ä½œè€…</div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary search-btn" onclick="searchApps()">ğŸ”</button>
                        
                        <!-- éšè—çš„åŸå§‹selectå…ƒç´ ï¼Œç”¨äºä¿æŒåŠŸèƒ½ -->
                        <select class="filter-select" id="category-filter-mobile" style="display: none;">
                            <option value="">å…¨éƒ¨åˆ†ç±»</option>
                            <option value="å·¥å…·">å·¥å…·</option>
                            <option value="å­¦ä¹ ">å­¦ä¹ </option>
                            <option value="æ¸¸æˆ">æ¸¸æˆ</option>
                            <option value="è‰ºæœ¯">è‰ºæœ¯</option>
                            <option value="ç§‘æŠ€">ç§‘æŠ€</option>
                        </select>
                        <select class="filter-select" id="sort-filter-mobile" style="display: none;">
                            <option value="newest">æœ€æ–°å‘å¸ƒ</option>
                            <option value="oldest">æœ€æ—©å‘å¸ƒ</option>
                            <option value="name">æŒ‰åç§°</option>
                            <option value="author">æŒ‰ä½œè€…</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div id="apps-container">
                <div class="apps-grid" id="apps-grid">
                    <!-- åº”ç”¨å¡ç‰‡å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                </div>
                
                <div class="empty-state" id="empty-state" style="display: none;">
                    <h3>æš‚æ— ä½œå“</h3>
                    <p>æ¥å±•ç¤ºä½ çš„ç¬¬ä¸€ä¸ªä½œå“å§ï¼</p>
                </div>
            </div>
        </div>
    </div>

    <!-- å‘å¸ƒ/ç¼–è¾‘åº”ç”¨æŒ‰é’® -->
    <button class="publish-btn" id="publish-btn" onclick="showPublishModal()" style="display: none;" title="å‘å¸ƒåº”ç”¨">+</button>

    <!-- ç§»åŠ¨ç«¯èœå• -->
    <div class="mobile-nav-overlay" id="mobile-nav-overlay" onclick="closeMobileMenu()"></div>
    <div class="mobile-nav-menu" id="mobile-nav-menu">
        <div class="mobile-nav-header">
            <div class="mobile-nav-title">èœå•</div>
            <button class="mobile-nav-close" onclick="closeMobileMenu()">&times;</button>
        </div>
        
        <!-- æœªç™»å½•çŠ¶æ€èœå• -->
        <div id="mobile-guest-nav" style="display: none;">
            <div class="mobile-nav-items">
                <button class="mobile-nav-item" onclick="showLogin(); closeMobileMenu();">
                    ğŸ‘¤ ç™»å½•
                </button>
                <button class="mobile-nav-item" onclick="showRegister(); closeMobileMenu();">
                    âœ¨ æ³¨å†Œ
                </button>
            </div>
        </div>
        
        <!-- å·²ç™»å½•çŠ¶æ€èœå• -->
        <div id="mobile-user-nav" style="display: none;">
            <div class="mobile-user-info">
                <div class="user-avatar" id="mobile-user-avatar"></div>
                <span id="mobile-user-name"></span>
            </div>
            <div class="mobile-nav-items">
                <button class="mobile-nav-item" onclick="goHome(); closeMobileMenu();">
                    ğŸ  é¦–é¡µ
                </button>
                <button class="mobile-nav-item" onclick="showPublishModal(); closeMobileMenu();" style="background: linear-gradient(45deg, #ff9500, #ff6600); color: white; border-color: #ff9500;">
                    â• å‘å¸ƒä½œå“
                </button>
                <button class="mobile-nav-item" onclick="showMyApps(); closeMobileMenu();">
                    ğŸ“± æˆ‘çš„åº”ç”¨
                </button>
                <button class="mobile-nav-item" onclick="showMyFavorites(); closeMobileMenu();">
                    â­ æˆ‘çš„æ”¶è—
                </button>
                <button class="mobile-nav-item" onclick="showLogViewer(); closeMobileMenu();" style="display: none;" id="mobile-log-viewer-btn">
                    ğŸ“‹ æŸ¥çœ‹æ—¥å¿—
                </button>
                <button class="mobile-nav-item" onclick="logout(); closeMobileMenu();">
                    ğŸšª é€€å‡ºç™»å½•
                </button>
            </div>
        </div>
    </div>

    <!-- å‘å¸ƒ/ç¼–è¾‘åº”ç”¨æ¨¡æ€æ¡† -->
    <div class="modal" id="publish-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="publish-modal-title">å‘å¸ƒä½œå“</h2>
                <button class="close-btn" onclick="closeModal('publish-modal')">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label for="app-name">ä½œå“åç§° *</label>
                    <input type="text" id="app-name" placeholder="ç»™ä½ çš„ä½œå“èµ·ä¸ªåå­—">
                </div>
                <div class="form-group">
                    <label for="app-url">ä½œå“é“¾æ¥ *</label>
                    <input type="url" id="app-url" placeholder="https://example.com">
                </div>
                <div class="form-group">
                    <label for="app-description">ä½œå“æè¿° *</label>
                    <textarea id="app-description" placeholder="ä»‹ç»ä¸€ä¸‹ä½ çš„ä½œå“ï¼Œæ¯”å¦‚åˆ›ä½œçµæ„Ÿã€ä¸»è¦åŠŸèƒ½ç­‰..."></textarea>
                </div>
                <div class="form-group">
                    <label for="app-category">åˆ†ç±»</label>
                    <select id="app-category">
                        <option value="å…¶ä»–">å…¶ä»–</option>
                        <option value="å·¥å…·">å·¥å…·</option>
                        <option value="å­¦ä¹ ">å­¦ä¹ </option>
                        <option value="æ¸¸æˆ">æ¸¸æˆ</option>
                        <option value="è‰ºæœ¯">è‰ºæœ¯</option>
                        <option value="ç§‘æŠ€">ç§‘æŠ€</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>åº”ç”¨æˆªå›¾</label>
                    <div class="screenshot-preview" id="screenshot-preview">
                        <div class="placeholder">
                            <div style="font-size: 2rem;">ğŸ“¸</div>
                            <div>é€‰æ‹©æˆªå›¾æ–¹å¼</div>
                        </div>
                    </div>
                    <div style="margin-top: 0.5rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <label style="font-weight: normal; font-size: 0.9rem;">æˆªå›¾æ–¹å¼ï¼š</label>
                        </div>
                        <div class="capture-method-row">
                            <label>
                                <input type="radio" name="screenshot-method" value="api" checked onchange="toggleScreenshotMethod()">
                                <span>è‡ªåŠ¨ç”Ÿæˆæˆªå›¾</span>
                            </label>
                            <label>
                                <input type="radio" name="screenshot-method" value="upload" onchange="toggleScreenshotMethod()">
                                <span>ä¸Šä¼ æœ¬åœ°å›¾ç‰‡</span>
                            </label>
                        </div>
                        <div id="screenshot-api-section" style="display: block;">
                            <button type="button" class="btn btn-secondary" onclick="generateScreenshot()">
                                ğŸŒ ç”Ÿæˆç½‘é¡µæˆªå›¾
                            </button>
                            <div style="font-size: 0.8rem; color: #666; margin-top: 0.25rem;">
                                æ ¹æ®åº”ç”¨é“¾æ¥è‡ªåŠ¨ç”Ÿæˆç½‘é¡µæˆªå›¾
                            </div>
                        </div>
                        <div id="screenshot-upload-section" style="display: none;">
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('screenshot-upload').click()">
                                ğŸ“ ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶
                            </button>
                            <div style="font-size: 0.8rem; color: #666; margin-top: 0.25rem;">
                                æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œæœ€å¤§ 5MB
                            </div>
                        </div>
                    </div>
                    <input type="file" id="screenshot-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal('publish-modal')">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" id="save-app-btn" onclick="handleSaveApp()">å‘å¸ƒ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div class="modal" id="login-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ç”¨æˆ·ç™»å½•</h2>
                <button class="close-btn" onclick="closeModal('login-modal')">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label for="login-username">ç”¨æˆ·å</label>
                    <input type="text" id="login-username" placeholder="è¾“å…¥ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <label for="login-password">å¯†ç </label>
                    <input type="password" id="login-password" placeholder="è¾“å…¥å¯†ç ">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal('login-modal')">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="handleLogin()">ç™»å½•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ³¨å†Œæ¨¡æ€æ¡† -->
    <div class="modal" id="register-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ç”¨æˆ·æ³¨å†Œ</h2>
                <button class="close-btn" onclick="closeModal('register-modal')">&times;</button>
            </div>
            <div>
                <div class="form-group">
                    <label for="register-username">ç”¨æˆ·å</label>
                    <input type="text" id="register-username" placeholder="è¾“å…¥ç”¨æˆ·å">
                </div>
                <div class="form-group">
                    <label for="register-email">é‚®ç®±</label>
                    <input type="email" id="register-email" placeholder="è¾“å…¥é‚®ç®±">
                </div>
                <div class="form-group">
                    <label for="register-password">å¯†ç </label>
                    <input type="password" id="register-password" placeholder="è‡³å°‘6ä¸ªå­—ç¬¦">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal('register-modal')">å–æ¶ˆ</button>
                    <button type="button" class="btn btn-primary" onclick="handleRegister()">æ³¨å†Œ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ—¥å¿—æŸ¥çœ‹æ¨¡æ€æ¡† -->
    <div class="modal" id="log-viewer-modal">
        <div class="modal-content" style="max-width: 800px; height: 80vh;">
            <div class="modal-header">
                <h2 class="modal-title">ç³»ç»Ÿæ—¥å¿—</h2>
                <button class="close-btn" onclick="closeModal('log-viewer-modal')">&times;</button>
            </div>
            <div style="display: flex; flex-direction: column; height: calc(80vh - 120px);">
                <div style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: center; flex-wrap: wrap;">
                    <select id="log-level-filter" onchange="refreshLogs()" style="padding: 0.5rem; border-radius: 4px; border: 1px solid #ddd;">
                        <option value="">å…¨éƒ¨çº§åˆ«</option>
                        <option value="INFO">ä¿¡æ¯</option>
                        <option value="WARN">è­¦å‘Š</option>
                        <option value="ERROR">é”™è¯¯</option>
                    </select>
                    <input type="text" id="log-username-filter" placeholder="æŒ‰ç”¨æˆ·åç­›é€‰..." onchange="refreshLogs()" style="padding: 0.5rem; border-radius: 4px; border: 1px solid #ddd;">
                    <button class="btn btn-secondary" onclick="refreshLogs()">åˆ·æ–°</button>
                    <button class="btn btn-secondary" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
                    <button class="btn btn-secondary" onclick="exportLogs()">å¯¼å‡ºæ—¥å¿—</button>
                </div>
                <div id="log-content" style="flex: 1; overflow-y: auto; border: 1px solid #ddd; padding: 1rem; font-family: 'Courier New', monospace; font-size: 0.9rem; background: #f8f9fa;">
                    <!-- æ—¥å¿—å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // äº‘å­˜å‚¨é…ç½® - ä½¿ç”¨JSONBinå…è´¹æœåŠ¡
        const CLOUD_CONFIG = {
            // JSONBiné…ç½®
            binId: '', // å°†åœ¨ Netlify å‡½æ•°ä¸­è®¾ç½®
            apiKey: '', // å°†åœ¨ Netlify å‡½æ•°ä¸­è®¾ç½®
            baseUrl: 'https://api.jsonbin.io/v3/b'
        };

        // å…¨å±€å˜é‡
        let currentUser = null;
        let currentEditingAppId = null; // ç”¨äºè·Ÿè¸ªæ­£åœ¨ç¼–è¾‘çš„åº”ç”¨ID
        let cloudData = {
            users: [],
            apps: [],
            lastSync: null
        };

        // äº‘å­˜å‚¨APIç±»
        class CloudStorage {
            constructor() {
                this.baseUrl = '/.netlify/functions/jsonbin-proxy';
            }

            async saveData(data) {
                try {
                    const response = await fetch(this.baseUrl, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
                    
                    if (!response.ok) {
                        throw new Error('ä¿å­˜å¤±è´¥');
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('ä¿å­˜åˆ°äº‘ç«¯å¤±è´¥:', error);
                    throw error;
                }
            }

            async loadData() {
                try {
                    const response = await fetch(this.baseUrl, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        throw new Error('åŠ è½½å¤±è´¥');
                    }
                    
                    const result = await response.json();
                    return result.record || { users: [], apps: [], lastSync: null };
                } catch (error) {
                    console.error('ä»äº‘ç«¯åŠ è½½å¤±è´¥:', error);
                    throw error;
                }
            }
        }

        const cloudStorage = new CloudStorage();

        // æ—¥å¿—è®°å½•ç³»ç»Ÿ
        class Logger {
            constructor() {
                this.logs = JSON.parse(localStorage.getItem('beestoreLogs') || '[]');
                this.maxLogs = 1000; // æœ€å¤šä¿å­˜1000æ¡æ—¥å¿—
            }

            getFormattedLog(level, message, data = null) {
                const timestamp = new Date().toISOString();
                const userInfo = currentUser ? {
                    id: currentUser.id,
                    username: currentUser.username
                } : { id: null, username: 'guest' };

                return {
                    timestamp,
                    level,
                    message,
                    user: userInfo,
                    data,
                    id: Date.now() + Math.random()
                };
            }

            info(message, data = null) {
                const log = this.getFormattedLog('INFO', message, data);
                this.logs.unshift(log);
                console.log(`[BeeStore] ${message}`, data);
                this.saveLogs();
                return log;
            }

            warn(message, data = null) {
                const log = this.getFormattedLog('WARN', message, data);
                this.logs.unshift(log);
                console.warn(`[BeeStore] ${message}`, data);
                this.saveLogs();
                return log;
            }

            error(message, data = null) {
                const log = this.getFormattedLog('ERROR', message, data);
                this.logs.unshift(log);
                console.error(`[BeeStore] ${message}`, data);
                this.saveLogs();
                return log;
            }

            saveLogs() {
                // é™åˆ¶æ—¥å¿—æ•°é‡
                if (this.logs.length > this.maxLogs) {
                    this.logs = this.logs.slice(0, this.maxLogs);
                }
                localStorage.setItem('beestoreLogs', JSON.stringify(this.logs));
            }

            getLogs(limit = 100, level = null, username = null) {
                let filteredLogs = this.logs;

                if (level) {
                    filteredLogs = filteredLogs.filter(log => log.level === level);
                }

                if (username) {
                    filteredLogs = filteredLogs.filter(log => log.user.username === username);
                }

                return filteredLogs.slice(0, limit);
            }

            clearLogs() {
                this.logs = [];
                localStorage.removeItem('beestoreLogs');
                console.log('[BeeStore] æ—¥å¿—å·²æ¸…ç©º');
            }
        }

        const logger = new Logger();

        // æ•°æ®åˆå¹¶å‡½æ•°
        function mergeCloudData(remoteData) {
            logger.info('å¼€å§‹åˆå¹¶äº‘ç«¯å’Œæœ¬åœ°æ•°æ®', { 
                localUsers: cloudData?.users?.length || 0,
                localApps: cloudData?.apps?.length || 0,
                remoteUsers: remoteData?.users?.length || 0,
                remoteApps: remoteData?.apps?.length || 0,
                operation: 'æ•°æ®åˆå¹¶'
            });
            
            // å¦‚æœæ²¡æœ‰æœ¬åœ°æ•°æ®ï¼Œç›´æ¥ä½¿ç”¨è¿œç¨‹æ•°æ®
            if (!cloudData || !cloudData.users || !cloudData.apps) {
                logger.info('æ— æœ¬åœ°æ•°æ®ï¼Œä½¿ç”¨è¿œç¨‹æ•°æ®', { operation: 'æ•°æ®åˆå¹¶' });
                return remoteData || { users: [], apps: [], lastSync: null };
            }

            // å¦‚æœæ²¡æœ‰è¿œç¨‹æ•°æ®ï¼Œä¿æŒæœ¬åœ°æ•°æ®
            if (!remoteData || !remoteData.users || !remoteData.apps) {
                logger.info('æ— è¿œç¨‹æ•°æ®ï¼Œä¿æŒæœ¬åœ°æ•°æ®', { operation: 'æ•°æ®åˆå¹¶' });
                return cloudData;
            }

            const merged = {
                users: [],
                apps: [],
                lastSync: remoteData.lastSync || new Date().toISOString()
            };

            // åˆå¹¶ç”¨æˆ·æ•°æ®ï¼ˆåŸºäºIDå’Œåˆ›å»ºæ—¶é—´ï¼‰
            const allUsers = [...cloudData.users, ...remoteData.users];
            const userMap = new Map();
            
            allUsers.forEach(user => {
                const existing = userMap.get(user.id);
                if (!existing || new Date(user.createdAt) >= new Date(existing.createdAt)) {
                    userMap.set(user.id, user);
                }
            });
            merged.users = Array.from(userMap.values());

            // åˆå¹¶åº”ç”¨æ•°æ®ï¼ˆåŸºäºIDå’Œåˆ›å»ºæ—¶é—´ï¼‰
            const allApps = [...cloudData.apps, ...remoteData.apps];
            const appMap = new Map();
            
            allApps.forEach(app => {
                const existing = appMap.get(app.id);
                if (!existing || new Date(app.createdAt) >= new Date(existing.createdAt)) {
                    appMap.set(app.id, app);
                }
            });
            merged.apps = Array.from(appMap.values());

            logger.info('æ•°æ®åˆå¹¶å®Œæˆ', { 
                finalUsers: merged.users.length,
                finalApps: merged.apps.length,
                operation: 'æ•°æ®åˆå¹¶å®Œæˆ'
            });

            return merged;
        }

        // çŠ¶æ€ç®¡ç†
        let statusHideTimeout = null;
        function updateStatus(message, type = 'syncing') {
            const indicator = document.getElementById('status-indicator');
            indicator.textContent = message;
            indicator.className = `status-indicator status-${type}`;
            indicator.style.display = 'block';
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (statusHideTimeout) {
                clearTimeout(statusHideTimeout);
                statusHideTimeout = null;
            }
            // æˆåŠŸçŠ¶æ€è‡ªåŠ¨éšè—
            if (type === 'connected') {
                statusHideTimeout = setTimeout(() => {
                    indicator.style.display = 'none';
                }, 3000);
            }
        }

        // åˆå§‹åŒ–
        async function init() {
            logger.info('Bee Store åº”ç”¨å¯åŠ¨', { 
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                operation: 'åº”ç”¨å¯åŠ¨'
            });
            
            updateStatus('â˜ï¸ æ­£åœ¨åŒæ­¥æ•°æ®...', 'syncing');
            
            try {
                // ä»äº‘ç«¯åŠ è½½æ•°æ®å¹¶åˆå¹¶
                cloudData = await mergeCloudData(await cloudStorage.loadData());
                
                // ç¡®ä¿æ•°æ®ç»“æ„å…¼å®¹æ€§ï¼ˆä¸ºæ—§æ•°æ®æ·»åŠ æ–°å­—æ®µï¼‰
                if (cloudData.apps) {
                    cloudData.apps.forEach(app => {
                        if (!app.likes) app.likes = [];
                        if (!app.favorites) app.favorites = [];
                        if (!app.comments) app.comments = [];
                    });
                }
                
                updateStatus('â˜ï¸ æ•°æ®åŒæ­¥æˆåŠŸ', 'connected');
                
                // æ£€æŸ¥æœ¬åœ°ç™»å½•çŠ¶æ€
                const storedUser = localStorage.getItem('currentUser');
                if (storedUser) {
                    const userData = JSON.parse(storedUser);
                    // éªŒè¯ç”¨æˆ·æ˜¯å¦ä»ç„¶å­˜åœ¨
                    let user = cloudData.users.find(u => u.id === userData.id);
                    
                    if (user) {
                        currentUser = user;
                        showUserNav();
                    } else {
                        // ç”¨æˆ·åœ¨äº‘ç«¯ä¸å­˜åœ¨ï¼Œå¯èƒ½æ˜¯æ•°æ®åŒæ­¥é—®é¢˜
                        console.warn('æœ¬åœ°ç”¨æˆ·åœ¨äº‘ç«¯ä¸å­˜åœ¨ï¼Œå°è¯•æ¢å¤ç”¨æˆ·æ•°æ®:', userData.username);
                        
                        // æ£€æŸ¥æ˜¯å¦æ˜¯ç”¨æˆ·åé‡å¤ï¼ˆå¯èƒ½æ˜¯IDå†²çªï¼‰
                        const existingUserByName = cloudData.users.find(u => u.username === userData.username);
                        if (existingUserByName) {
                            // ç”¨æˆ·åå­˜åœ¨ä½†IDä¸åŒï¼Œä½¿ç”¨äº‘ç«¯ç”¨æˆ·æ•°æ®
                            currentUser = existingUserByName;
                            localStorage.setItem('currentUser', JSON.stringify(existingUserByName));
                            showUserNav();
                            alert('æ£€æµ‹åˆ°ç”¨æˆ·æ•°æ®åŒæ­¥é—®é¢˜ï¼Œå·²è‡ªåŠ¨ä¿®å¤ç™»å½•çŠ¶æ€');
                        } else {
                            // å°è¯•æ¢å¤ç”¨æˆ·åˆ°äº‘ç«¯æ•°æ®åº“
                            const confirmRestore = confirm(
                                `æ£€æµ‹åˆ°æ‚¨çš„ç”¨æˆ·æ•°æ®å¯èƒ½å› åŒæ­¥é—®é¢˜ä¸¢å¤±ã€‚\n` +
                                `ç”¨æˆ·å: ${userData.username}\n` +
                                `æ˜¯å¦å°è¯•æ¢å¤ç”¨æˆ·æ•°æ®ï¼Ÿ\n\n` +
                                `ç‚¹å‡»"ç¡®å®š"æ¢å¤ï¼Œç‚¹å‡»"å–æ¶ˆ"é‡æ–°æ³¨å†Œ`
                            );
                            
                            if (confirmRestore) {
                                // æ¢å¤ç”¨æˆ·æ•°æ®åˆ°äº‘ç«¯
                                cloudData.users.push(userData);
                                currentUser = userData;
                                showUserNav();
                                
                                // ç«‹å³åŒæ­¥åˆ°äº‘ç«¯
                                syncData().then(() => {
                                    alert('ç”¨æˆ·æ•°æ®å·²æ¢å¤å¹¶åŒæ­¥åˆ°äº‘ç«¯');
                                }).catch(error => {
                                    console.error('æ¢å¤ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                                    alert('ç”¨æˆ·æ•°æ®æ¢å¤å¤±è´¥ï¼Œè¯·é‡æ–°æ³¨å†Œ');
                                    localStorage.removeItem('currentUser');
                                    showGuestNav();
                                });
                            } else {
                                localStorage.removeItem('currentUser');
                                showGuestNav();
                            }
                        }
                    }
                } else {
                    showGuestNav();
                }

                // åŠ è½½åº”ç”¨
                loadApps();
                updateStats();
                
                // è®¾ç½®æœç´¢äº‹ä»¶
                setupSearchEvents();
                
                // åˆå§‹åŒ–è‡ªå®šä¹‰ä¸‹æ‹‰èœå•çŠ¶æ€
                updateDropdownSelection('category', '');
                updateDropdownSelection('sort', 'newest');
                updateDropdownSelection('category-mobile', '');
                updateDropdownSelection('sort-mobile', 'newest');
                
            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                updateStatus('âŒ äº‘ç«¯è¿æ¥å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®', 'error');
                // ä½¿ç”¨æœ¬åœ°æ•°æ®æˆ–ç¤ºä¾‹æ•°æ®
                initLocalData();
                showGuestNav();
                loadApps();
                updateStats();
                
                // åˆå§‹åŒ–è‡ªå®šä¹‰ä¸‹æ‹‰èœå•çŠ¶æ€
                updateDropdownSelection('category', '');
                updateDropdownSelection('sort', 'newest');
                updateDropdownSelection('category-mobile', '');
                updateDropdownSelection('sort-mobile', 'newest');
                
                // æç¤ºç”¨æˆ·æ£€æŸ¥ç½‘ç»œè¿æ¥
                setTimeout(() => {
                    console.log('æç¤ºï¼šå¦‚æœæ˜¯é¦–æ¬¡è®¿é—®æˆ–ç¯å¢ƒå˜é‡æœªé…ç½®ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ã€‚æ•°æ®å°†ä½¿ç”¨æœ¬åœ°å­˜å‚¨ã€‚');
                }, 2000);
            }
        }

        // åˆå§‹åŒ–æœ¬åœ°æ•°æ®
        function initLocalData() {
            cloudData = {
                users: [
                    {
                        id: 1,
                        username: 'demo',
                        email: 'demo@example.com',
                        password: 'demo123',
                        createdAt: new Date().toISOString()
                    }
                ],
                apps: [
                    {
                        id: 1,
                        name: '2Brain',
                        url: 'https://portal.2brain.ai/',
                        description: 'çŸ¥è¯†åº“å‹AIå¹³å°ï¼Œå»ºç«‹çŸ¥è¯†åº“ã€æ™ºèƒ½ä½“ï¼ŒåŒ…æ‹¬æ¨¡æ¿å†™ä½œã€è‡ªç„¶è¯­è¨€excelåˆ†æã€æ™ºèƒ½å‡ºé¢˜è€ƒè¯•åˆ¤å·ç­‰åŠŸèƒ½',
                        category: 'å·¥å…·',
                        author: 'Beebee AI',
                        authorId: 1,
                        screenshot: '',
                        likes: [],
                        favorites: [],
                        comments: [],
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: 'Beebee Trademate',
                        url: 'https://beebee.com',
                        description: 'å•†æœºåŒ…ï¼Œå•†æœºæœç´¢å¼•æ“ï¼Œæ”¯æŒè‡ªç„¶è¯­è¨€æœç´¢ã€AIç”Ÿæˆé‚®ä»¶ä¸€é”®å‘é€',
                        category: 'å·¥å…·',
                        author: 'Beebee AI',
                        authorId: 1,
                        screenshot: '',
                        likes: [],
                        favorites: [],
                        comments: [],
                        createdAt: new Date().toISOString()
                    }
                ],
                lastSync: new Date().toISOString()
            };
        }

        // åŒæ­¥æ•°æ®åˆ°äº‘ç«¯
        async function syncData(retryCount = 0) {
            const maxRetries = 3;
            
            if (retryCount === 0) {
                logger.info('å¼€å§‹æ•°æ®åŒæ­¥åˆ°äº‘ç«¯', { 
                    usersCount: cloudData.users.length,
                    appsCount: cloudData.apps.length,
                    operation: 'æ•°æ®åŒæ­¥'
                });
                updateStatus('â˜ï¸ æ­£åœ¨åŒæ­¥...', 'syncing');
            } else {
                logger.warn(`æ•°æ®åŒæ­¥é‡è¯• ${retryCount}/${maxRetries}`, { 
                    retryCount: retryCount,
                    maxRetries: maxRetries,
                    operation: 'æ•°æ®åŒæ­¥é‡è¯•'
                });
                updateStatus(`â˜ï¸ é‡è¯•åŒæ­¥ (${retryCount}/${maxRetries})...`, 'syncing');
            }
            
            try {
                cloudData.lastSync = new Date().toISOString();
                
                // æ£€æŸ¥æ•°æ®å¤§å°
                const dataSize = JSON.stringify(cloudData).length;
                const maxSize = 5 * 1024 * 1024; // 5MB é™åˆ¶
                
                logger.info('æ•°æ®å¤§å°æ£€æŸ¥', { 
                    dataSize: dataSize,
                    dataSizeMB: Math.round(dataSize / 1024 / 1024 * 100) / 100,
                    maxSizeMB: Math.round(maxSize / 1024 / 1024),
                    operation: 'æ•°æ®å¤§å°æ£€æŸ¥'
                });
                
                if (dataSize > maxSize) {
                    logger.error('æ•°æ®å¤§å°è¶…è¿‡é™åˆ¶', { 
                        dataSize: dataSize,
                        dataSizeMB: Math.round(dataSize / 1024 / 1024 * 100) / 100,
                        maxSizeMB: Math.round(maxSize / 1024 / 1024),
                        operation: 'æ•°æ®å¤§å°è¶…é™'
                    });
                    console.warn(`æ•°æ®å¤§å°è¿‡å¤§: ${Math.round(dataSize / 1024 / 1024 * 100) / 100}MB`);
                    updateStatus('âš ï¸ æ•°æ®è¿‡å¤§ï¼Œå»ºè®®æ¸…ç†', 'error');
                    throw new Error(`æ•°æ®å¤§å° ${Math.round(dataSize / 1024 / 1024 * 100) / 100}MB è¶…è¿‡é™åˆ¶ ${Math.round(maxSize / 1024 / 1024)}MB`);
                }
                
                await cloudStorage.saveData(cloudData);
                logger.info('æ•°æ®åŒæ­¥æˆåŠŸ', { 
                    usersCount: cloudData.users.length,
                    appsCount: cloudData.apps.length,
                    retryCount: retryCount,
                    operation: 'æ•°æ®åŒæ­¥æˆåŠŸ'
                });
                updateStatus('â˜ï¸ åŒæ­¥æˆåŠŸ', 'connected');
                updateStats();
                return true;
            } catch (error) {
                logger.error(`æ•°æ®åŒæ­¥å¤±è´¥ (å°è¯• ${retryCount + 1}/${maxRetries + 1})`, { 
                    error: error.message,
                    retryCount: retryCount,
                    maxRetries: maxRetries,
                    operation: 'æ•°æ®åŒæ­¥å¤±è´¥'
                });
                console.error(`åŒæ­¥å¤±è´¥ (å°è¯• ${retryCount + 1}/${maxRetries + 1}):`, error);
                
                if (retryCount < maxRetries) {
                    // æŒ‡æ•°é€€é¿é‡è¯•ï¼šç¬¬ä¸€æ¬¡1ç§’ï¼Œç¬¬äºŒæ¬¡2ç§’ï¼Œç¬¬ä¸‰æ¬¡4ç§’
                    const delay = Math.pow(2, retryCount) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return await syncData(retryCount + 1);
                } else {
                    updateStatus('âŒ åŒæ­¥å¤±è´¥', 'error');
                    throw error;
                }
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const totalAppsElement = document.getElementById('total-apps');
            const totalUsersElement = document.getElementById('total-users');
            
            if (totalAppsElement) {
                totalAppsElement.textContent = cloudData.apps ? cloudData.apps.length : 0;
            }
            if (totalUsersElement) {
                totalUsersElement.textContent = cloudData.users ? cloudData.users.length : 0;
            }
        }

        // è®¾ç½®æœç´¢äº‹ä»¶
        function setupSearchEvents() {
            // æ¡Œé¢ç«¯æœç´¢æ¡†
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchApps();
                    }
                });
                searchInput.addEventListener('input', debounce(searchApps, 300));
            }

            // ç§»åŠ¨ç«¯æœç´¢æ¡†
            const searchInputMobile = document.getElementById('search-input-mobile');
            if (searchInputMobile) {
                searchInputMobile.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        searchApps();
                    }
                });
                searchInputMobile.addEventListener('input', debounce(searchApps, 300));
            }

            // åŒæ­¥æœç´¢æ¡†å†…å®¹
            function syncSearchInputs() {
                const desktopValue = searchInput ? searchInput.value : '';
                const mobileValue = searchInputMobile ? searchInputMobile.value : '';
                
                if (searchInput && searchInputMobile) {
                    if (document.activeElement === searchInput) {
                        searchInputMobile.value = desktopValue;
                    } else if (document.activeElement === searchInputMobile) {
                        searchInput.value = mobileValue;
                    }
                }
            }

            if (searchInput) searchInput.addEventListener('input', syncSearchInputs);
            if (searchInputMobile) searchInputMobile.addEventListener('input', syncSearchInputs);

            // ä¸ºç§»åŠ¨ç«¯ç­›é€‰å™¨æ·»åŠ äº‹ä»¶ç›‘å¬
            const categoryFilterMobile = document.getElementById('category-filter-mobile');
            const sortFilterMobile = document.getElementById('sort-filter-mobile');
            
            if (categoryFilterMobile) {
                categoryFilterMobile.addEventListener('change', searchApps);
            }
            if (sortFilterMobile) {
                sortFilterMobile.addEventListener('change', searchApps);
            }

            // åŒæ­¥æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯çš„ç­›é€‰å™¨å€¼
            function syncFilters() {
                const categoryFilter = document.getElementById('category-filter');
                const sortFilter = document.getElementById('sort-filter');
                
                if (categoryFilter && categoryFilterMobile) {
                    categoryFilter.addEventListener('change', function() {
                        categoryFilterMobile.value = this.value;
                        searchApps();
                    });
                    categoryFilterMobile.addEventListener('change', function() {
                        categoryFilter.value = this.value;
                    });
                }
                
                if (sortFilter && sortFilterMobile) {
                    sortFilter.addEventListener('change', function() {
                        sortFilterMobile.value = this.value;
                        searchApps();
                    });
                    sortFilterMobile.addEventListener('change', function() {
                        sortFilter.value = this.value;
                    });
                }
            }
            
            syncFilters();
        }

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // æœç´¢åº”ç”¨
        function searchApps() {
            loadApps();
        }

        // è·å–å½“å‰æœç´¢æ¡ä»¶ï¼ˆä¼˜å…ˆç§»åŠ¨ç«¯ï¼Œå¦‚æœç§»åŠ¨ç«¯å¯è§çš„è¯ï¼‰
        function getCurrentSearchTerms() {
            const isMobile = window.innerWidth <= 1024;
            
            let searchTerm = '';
            let categoryFilter = '';
            let sortFilter = '';
            
            if (isMobile) {
                // ç§»åŠ¨ç«¯
                const searchInputMobile = document.getElementById('search-input-mobile');
                const categoryFilterMobile = document.getElementById('category-filter-mobile');
                const sortFilterMobile = document.getElementById('sort-filter-mobile');
                
                searchTerm = searchInputMobile ? searchInputMobile.value.toLowerCase() : '';
                categoryFilter = categoryFilterMobile ? categoryFilterMobile.value : '';
                sortFilter = sortFilterMobile ? sortFilterMobile.value : '';
            } else {
                // æ¡Œé¢ç«¯
                const searchInput = document.getElementById('search-input');
                const categoryFilterDesktop = document.getElementById('category-filter');
                const sortFilterDesktop = document.getElementById('sort-filter');
                
                searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
                categoryFilter = categoryFilterDesktop ? categoryFilterDesktop.value : '';
                sortFilter = sortFilterDesktop ? sortFilterDesktop.value : '';
            }
            
            return { searchTerm, categoryFilter, sortFilter };
        }

        // åŠ è½½åº”ç”¨
        function loadApps() {
            const { searchTerm, categoryFilter, sortFilter } = getCurrentSearchTerms();

            let filteredApps = cloudData.apps;

            // æœç´¢è¿‡æ»¤
            if (searchTerm) {
                filteredApps = filteredApps.filter(app => 
                    app.name.toLowerCase().includes(searchTerm) ||
                    app.description.toLowerCase().includes(searchTerm) ||
                    app.author.toLowerCase().includes(searchTerm)
                );
            }

            // åˆ†ç±»è¿‡æ»¤
            if (categoryFilter) {
                filteredApps = filteredApps.filter(app => app.category === categoryFilter);
            }

            // æ’åº
            switch (sortFilter) {
                case 'newest':
                    filteredApps.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
                case 'oldest':
                    filteredApps.sort((a, b) => new Date(a.createdAt) - new Date(b.createdAt));
                    break;
                case 'name':
                    filteredApps.sort((a, b) => a.name.localeCompare(b.name));
                    break;
                case 'author':
                    filteredApps.sort((a, b) => a.author.localeCompare(b.author));
                    break;
            }

            displayApps(filteredApps);
        }

        // åˆ‡æ¢æè¿°å±•å¼€/æ”¶èµ·
        function toggleDescription(appId) {
            const descElement = document.getElementById(`desc-${appId}`);
            const toggleButton = document.getElementById(`toggle-${appId}`);
            
            if (descElement.classList.contains('collapsed')) {
                // å±•å¼€
                descElement.classList.remove('collapsed');
                descElement.classList.add('expanded');
                descElement.style.cursor = 'default';
                if (toggleButton) toggleButton.style.display = 'inline-block';
            } else {
                // æ”¶èµ·
                descElement.classList.remove('expanded');
                descElement.classList.add('collapsed');
                descElement.style.cursor = 'pointer';
                if (toggleButton) toggleButton.style.display = 'none';
            }
        }

        // æ£€æŸ¥æè¿°æ˜¯å¦éœ€è¦å±•å¼€æŒ‰é’®
        function checkDescriptionOverflow() {
            // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿DOMå·²æ¸²æŸ“
            setTimeout(() => {
                const descriptions = document.querySelectorAll('.app-description.collapsed');
                descriptions.forEach(desc => {
                    const appId = desc.id.replace('desc-', '');
                    const toggleButton = document.getElementById(`toggle-${appId}`);
                    
                    // è·å–çº¯æ–‡æœ¬å†…å®¹
                    const textContent = desc.textContent.trim();
                    
                    // åˆ›å»ºä¸´æ—¶å…ƒç´ æ¥æµ‹é‡å®Œæ•´æ–‡æœ¬é«˜åº¦
                    const tempDiv = document.createElement('div');
                    tempDiv.style.cssText = `
                        position: absolute;
                        visibility: hidden;
                        width: ${desc.offsetWidth}px;
                        font-size: ${window.getComputedStyle(desc).fontSize};
                        font-family: ${window.getComputedStyle(desc).fontFamily};
                        line-height: ${window.getComputedStyle(desc).lineHeight};
                        padding: 0;
                        margin: 0;
                        border: none;
                    `;
                    tempDiv.textContent = textContent;
                    document.body.appendChild(tempDiv);
                    
                    const fullHeight = tempDiv.offsetHeight;
                    document.body.removeChild(tempDiv);
                    
                    // è·å–2è¡Œçš„é¢„æœŸé«˜åº¦ï¼ˆè¡Œé«˜ * 2ï¼‰
                    const lineHeight = parseFloat(window.getComputedStyle(desc).lineHeight);
                    const twoLineHeight = lineHeight * 2;
                    
                    // å¦‚æœå®Œæ•´é«˜åº¦è¶…è¿‡2è¡Œé«˜åº¦ï¼Œæ˜¾ç¤ºå±•å¼€åŠŸèƒ½
                    if (fullHeight > twoLineHeight + 5) { // 5pxå®¹å·®
                        desc.classList.add('has-overflow');
                        desc.style.cursor = 'pointer';
                        
                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼ˆé¿å…é‡å¤æ·»åŠ ï¼‰
                        if (!desc.hasAttribute('data-click-added')) {
                            desc.addEventListener('click', function() {
                                toggleDescription(appId);
                            });
                            desc.setAttribute('data-click-added', 'true');
                        }
                        
                        if (toggleButton) toggleButton.style.display = 'none';
                    } else {
                        desc.classList.remove('has-overflow');
                        desc.style.cursor = 'default';
                        if (toggleButton) toggleButton.style.display = 'none';
                    }
                });
            }, 200);
        }

        // æ˜¾ç¤ºåº”ç”¨
        function displayApps(apps, showActions = false) {
            const appsGrid = document.getElementById('apps-grid');
            const emptyState = document.getElementById('empty-state');

            if (apps.length === 0) {
                appsGrid.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            appsGrid.innerHTML = apps.map(app => {
                const isLiked = currentUser && app.likes && app.likes.includes(currentUser.id);
                const isFavorited = currentUser && app.favorites && app.favorites.includes(currentUser.id);
                const likesCount = app.likes ? app.likes.length : 0;
                const commentsCount = app.comments ? app.comments.length : 0;
                
                return `
                <div class="app-card">
                    ${showActions && currentUser && currentUser.id === app.authorId ? `
                        <div class="app-actions">
                            <button class="app-action-btn edit-btn" onclick="showEditModal(${app.id})" title="ç¼–è¾‘">âœï¸</button>
                            <button class="app-action-btn" onclick="deleteApp(${app.id})" title="åˆ é™¤">ğŸ—‘ï¸</button>
                        </div>
                    ` : ''}
                    <div class="app-screenshot">
                        ${app.screenshot && app.screenshot.trim() ? 
                            `<img src="${app.screenshot}" alt="${app.name}" onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=\\'placeholder\\'><div style=\\'font-size: 2rem;\\'>ğŸŒ</div><div>æš‚æ— æˆªå›¾</div></div>'">` :
                            '<div class="placeholder"><div style="font-size: 2rem;">ğŸŒ</div><div>æš‚æ— æˆªå›¾</div></div>'
                        }
                    </div>
                    <div class="app-info">
                        <h3>${app.name}</h3>
                        <div class="app-description collapsed" id="desc-${app.id}" data-full-text="${app.description.replace(/"/g, '&quot;')}">${app.description}</div>
                        <button class="description-toggle" onclick="toggleDescription(${app.id})" id="toggle-${app.id}" style="display: none;">æ”¶èµ·</button>
                        <div class="app-meta">
                            <span>ğŸ‘¤ ${app.author}</span>
                            <span>ğŸ“… ${new Date(app.createdAt).toLocaleDateString()}</span>
                        </div>
                        <div class="app-meta">
                            <span>ğŸ·ï¸ ${app.category}</span>
                            <a href="${app.url}" target="_blank" class="app-url" title="è®¿é—®é“¾æ¥ï¼š${app.url}">ğŸ”— è®¿é—®é“¾æ¥</a>
                        </div>
                        
                        <!-- äº’åŠ¨æŒ‰é’® -->
                        <div class="app-interactions">
                            <div class="interaction-group">
                                <button class="interaction-btn ${isLiked ? 'active' : ''}" onclick="toggleLike(${app.id})" ${!currentUser ? 'disabled title="è¯·å…ˆç™»å½•"' : ''}>
                                    ${isLiked ? 'â¤ï¸' : 'ğŸ¤'} ${likesCount}
                                </button>
                                <button class="interaction-btn" onclick="showComments(${app.id})" ${!currentUser ? 'disabled title="è¯·å…ˆç™»å½•"' : ''}>
                                    ğŸ’¬ ${commentsCount}
                                </button>
                                <button class="interaction-btn ${isFavorited ? 'active' : ''}" onclick="toggleFavorite(${app.id})" ${!currentUser ? 'disabled title="è¯·å…ˆç™»å½•"' : ''}>
                                    ${isFavorited ? 'â­' : 'â˜†'} æ”¶è—
                                </button>
                            </div>
                        </div>
                        
                        <!-- è¯„è®ºåŒºåŸŸ -->
                        <div class="comments-section" id="comments-${app.id}" style="display: none;">
                            <div id="comments-list-${app.id}">
                                ${app.comments ? app.comments.map(comment => `
                                    <div class="comment-item">
                                        <div class="comment-header">
                                            <span class="comment-author">${comment.author}</span>
                                            <div>
                                                <span>${new Date(comment.createdAt).toLocaleDateString()}</span>
                                                ${currentUser && currentUser.id === comment.authorId ? `
                                                    <button class="comment-delete" onclick="deleteComment(${app.id}, ${comment.id})">åˆ é™¤</button>
                                                ` : ''}
                                            </div>
                                        </div>
                                        <div class="comment-content">${comment.content}</div>
                                    </div>
                                `).join('') : ''}
                            </div>
                            ${currentUser ? `
                                <div class="comment-input">
                                    <input type="text" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." id="comment-input-${app.id}" onkeypress="if(event.key==='Enter') addComment(${app.id})">
                                    <button onclick="addComment(${app.id})">å‘é€</button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
                `;
            }).join('');
            
            // æ£€æŸ¥å“ªäº›æè¿°éœ€è¦å±•å¼€æŒ‰é’®
            checkDescriptionOverflow();
        }

        // åˆ é™¤åº”ç”¨
        async function deleteApp(appId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåº”ç”¨å—ï¼Ÿ')) return;

            try {
                cloudData.apps = cloudData.apps.filter(app => app.id !== appId);
                await syncData();
                loadApps();
                alert('åˆ é™¤æˆåŠŸï¼');
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤ºæˆ‘çš„åº”ç”¨
        function showMyApps() {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }

            const myApps = cloudData.apps.filter(app => app.authorId === currentUser.id);
            displayApps(myApps, true);
        }

        // æ˜¾ç¤ºæˆ‘çš„æ”¶è—
        function showMyFavorites() {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }

            const myFavorites = cloudData.apps.filter(app => 
                app.favorites && app.favorites.includes(currentUser.id)
            );
            displayApps(myFavorites, false);
        }

        // ç‚¹èµåŠŸèƒ½
        async function toggleLike(appId) {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }

            try {
                const app = cloudData.apps.find(app => app.id === appId);
                if (!app) return;

                if (!app.likes) app.likes = [];

                const likedIndex = app.likes.indexOf(currentUser.id);
                if (likedIndex > -1) {
                    app.likes.splice(likedIndex, 1);
                } else {
                    app.likes.push(currentUser.id);
                }

                await syncData();
                loadApps(); // é‡æ–°åŠ è½½ä»¥æ›´æ–°UI
            } catch (error) {
                alert('æ“ä½œå¤±è´¥: ' + error.message);
            }
        }

        // æ”¶è—åŠŸèƒ½
        async function toggleFavorite(appId) {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }

            try {
                const app = cloudData.apps.find(app => app.id === appId);
                if (!app) return;

                if (!app.favorites) app.favorites = [];

                const favoritedIndex = app.favorites.indexOf(currentUser.id);
                if (favoritedIndex > -1) {
                    app.favorites.splice(favoritedIndex, 1);
                } else {
                    app.favorites.push(currentUser.id);
                }

                await syncData();
                loadApps(); // é‡æ–°åŠ è½½ä»¥æ›´æ–°UI
            } catch (error) {
                alert('æ“ä½œå¤±è´¥: ' + error.message);
            }
        }

        // æ˜¾ç¤º/éšè—è¯„è®º
        function showComments(appId) {
            const commentsSection = document.getElementById(`comments-${appId}`);
            if (commentsSection.style.display === 'none') {
                commentsSection.style.display = 'block';
            } else {
                commentsSection.style.display = 'none';
            }
        }

        // æ·»åŠ è¯„è®º
        async function addComment(appId) {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }

            const input = document.getElementById(`comment-input-${appId}`);
            const content = input.value.trim();
            
            if (!content) {
                alert('è¯·è¾“å…¥è¯„è®ºå†…å®¹');
                return;
            }

            try {
                const app = cloudData.apps.find(app => app.id === appId);
                if (!app) return;

                if (!app.comments) app.comments = [];

                const newComment = {
                    id: Date.now(),
                    content,
                    author: currentUser.username,
                    authorId: currentUser.id,
                    createdAt: new Date().toISOString()
                };

                app.comments.push(newComment);
                input.value = '';

                await syncData();
                loadApps(); // é‡æ–°åŠ è½½ä»¥æ›´æ–°UI
            } catch (error) {
                alert('è¯„è®ºå¤±è´¥: ' + error.message);
            }
        }

        // åˆ é™¤è¯„è®º
        async function deleteComment(appId, commentId) {
            if (!currentUser) {
                alert('è¯·å…ˆç™»å½•');
                return;
            }

            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ')) return;

            try {
                const app = cloudData.apps.find(app => app.id === appId);
                if (!app || !app.comments) return;

                const comment = app.comments.find(c => c.id === commentId);
                if (!comment || comment.authorId !== currentUser.id) {
                    alert('åªèƒ½åˆ é™¤è‡ªå·±çš„è¯„è®º');
                    return;
                }

                app.comments = app.comments.filter(c => c.id !== commentId);

                await syncData();
                loadApps(); // é‡æ–°åŠ è½½ä»¥æ›´æ–°UI
            } catch (error) {
                alert('åˆ é™¤å¤±è´¥: ' + error.message);
            }
        }

        // ç§»åŠ¨ç«¯èœå•æ§åˆ¶
        function toggleMobileMenu() {
            const hamburger = document.getElementById('hamburger-menu');
            const overlay = document.getElementById('mobile-nav-overlay');
            const menu = document.getElementById('mobile-nav-menu');
            
            const isOpen = menu.classList.contains('active');
            
            if (isOpen) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        }

        function openMobileMenu() {
            const hamburger = document.getElementById('hamburger-menu');
            const overlay = document.getElementById('mobile-nav-overlay');
            const menu = document.getElementById('mobile-nav-menu');
            
            hamburger.classList.add('active');
            overlay.style.display = 'block';
            
            // å»¶è¿Ÿæ·»åŠ activeç±»ä»¥è§¦å‘åŠ¨ç”»
            setTimeout(() => {
                overlay.classList.add('active');
                menu.classList.add('active');
            }, 10);
            
            // ç¦æ­¢èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = 'hidden';
        }

        function closeMobileMenu() {
            const hamburger = document.getElementById('hamburger-menu');
            const overlay = document.getElementById('mobile-nav-overlay');
            const menu = document.getElementById('mobile-nav-menu');
            
            hamburger.classList.remove('active');
            overlay.classList.remove('active');
            menu.classList.remove('active');
            
            // å»¶è¿Ÿéšè—é®ç½©å±‚ä»¥å®ŒæˆåŠ¨ç”»
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 300);
            
            // æ¢å¤èƒŒæ™¯æ»šåŠ¨
            document.body.style.overflow = '';
        }

        // æ˜¾ç¤ºå¯¼èˆª
        function showGuestNav() {
            // æ¡Œé¢ç«¯å¯¼èˆª
            document.getElementById('guest-nav').style.display = 'flex';
            document.getElementById('user-nav').style.display = 'none';
            document.getElementById('publish-btn').style.display = 'none';
            
            // ç§»åŠ¨ç«¯å¯¼èˆª
            document.getElementById('mobile-guest-nav').style.display = 'block';
            document.getElementById('mobile-user-nav').style.display = 'none';
        }

        function showUserNav() {
            // æ¡Œé¢ç«¯å¯¼èˆª
            document.getElementById('guest-nav').style.display = 'none';
            document.getElementById('user-nav').style.display = 'flex';
            document.getElementById('publish-btn').style.display = 'block';

            if (currentUser) {
                // æ¡Œé¢ç«¯ç”¨æˆ·ä¿¡æ¯
                document.getElementById('user-name').textContent = currentUser.username;
                document.getElementById('user-avatar').textContent = currentUser.username.charAt(0).toUpperCase();
                
                // ç§»åŠ¨ç«¯ç”¨æˆ·ä¿¡æ¯
                document.getElementById('mobile-user-name').textContent = currentUser.username;
                document.getElementById('mobile-user-avatar').textContent = currentUser.username.charAt(0).toUpperCase();
            }
            
            // ç§»åŠ¨ç«¯å¯¼èˆª
            document.getElementById('mobile-guest-nav').style.display = 'none';
            document.getElementById('mobile-user-nav').style.display = 'block';
        }

        // æ¨¡æ€æ¡†æ“ä½œ
        function showModal(modalId) {
            document.body.classList.add('no-scroll');
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.body.classList.remove('no-scroll');
            document.getElementById(modalId).style.display = 'none';
            
            // å¦‚æœæ˜¯å‘å¸ƒæ¨¡æ€æ¡†ï¼Œé‡ç½®è¡¨å•
            if (modalId === 'publish-modal') {
                resetPublishModal();
            }
        }

        function resetPublishModal() {
            document.getElementById('app-name').value = '';
            document.getElementById('app-url').value = '';
            document.getElementById('app-description').value = '';
            document.getElementById('app-category').value = 'å…¶ä»–';
            document.getElementById('screenshot-upload').value = '';
            document.getElementById('screenshot-preview').innerHTML = '<div class="placeholder"><div style="font-size: 2rem;">ğŸ“¸</div><div>é€‰æ‹©æˆªå›¾æ–¹å¼</div></div>';
            
            // é‡ç½®æˆªå›¾æ–¹å¼ä¸ºAPIç”Ÿæˆ
            document.querySelector('input[name="screenshot-method"][value="api"]').checked = true;
            toggleScreenshotMethod();
        }

        function showLogin() {
            showModal('login-modal');
        }

        function showRegister() {
            showModal('register-modal');
        }

        function showPublishModal() {
            currentEditingAppId = null;
            document.getElementById('publish-modal-title').textContent = 'å‘å¸ƒä½œå“';
            document.getElementById('save-app-btn').textContent = 'å‘å¸ƒ';
            
            // ç¡®ä¿URLå­—æ®µå¯ç¼–è¾‘
            document.getElementById('app-url').readOnly = false;
            document.getElementById('app-url').style.background = '';
            
            // é‡ç½®è¡¨å•å¹¶æ˜¾ç¤ºæ¨¡æ€æ¡†
            resetPublishModal();
            showModal('publish-modal');
        }

        function showEditModal(appId) {
            currentEditingAppId = appId;
            const app = cloudData.apps.find(a => a.id === appId);
            if (!app) return;

            document.getElementById('publish-modal-title').textContent = 'ç¼–è¾‘ä½œå“';
            document.getElementById('save-app-btn').textContent = 'ä¿å­˜æ›´æ”¹';
            
            // å¡«å……è¡¨å•
            document.getElementById('app-name').value = app.name;
            document.getElementById('app-url').value = app.url;
            document.getElementById('app-description').value = app.description;
            document.getElementById('app-category').value = app.category;
            
            const preview = document.getElementById('screenshot-preview');
            if (app.screenshot && app.screenshot.trim()) {
                preview.innerHTML = `<img src="${app.screenshot}" alt="åº”ç”¨æˆªå›¾" data-base64="${app.screenshot}">`;
            } else {
                preview.innerHTML = '<div class="placeholder"><div style="font-size: 2rem;">ğŸ“¸</div><div>é€‰æ‹©æˆªå›¾æ–¹å¼</div></div>';
            }

            // URLåœ¨ç¼–è¾‘æ—¶ä¸å¯æ›´æ”¹
            document.getElementById('app-url').readOnly = true;
            document.getElementById('app-url').style.background = '#f1f1f1';

            showModal('publish-modal');
        }

        // å¤„ç†ç™»å½•
        async function handleLogin() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();

            logger.info('ç”¨æˆ·å°è¯•ç™»å½•', { 
                username: username,
                operation: 'ç”¨æˆ·ç™»å½•å°è¯•'
            });

            if (!username || !password) {
                logger.warn('ç™»å½•å¤±è´¥ï¼šç¼ºå°‘ç”¨æˆ·åæˆ–å¯†ç ', { username: username });
                alert('è¯·å¡«å†™ç”¨æˆ·åå’Œå¯†ç ');
                return;
            }

            const user = cloudData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                logger.info('ç”¨æˆ·ç™»å½•æˆåŠŸ', { 
                    userId: user.id,
                    username: user.username,
                    operation: 'ç”¨æˆ·ç™»å½•æˆåŠŸ'
                });
                currentUser = user;
                localStorage.setItem('currentUser', JSON.stringify(user));
                showUserNav();
                closeModal('login-modal');
                alert('ç™»å½•æˆåŠŸï¼');
            } else {
                logger.warn('ç”¨æˆ·ç™»å½•å¤±è´¥ï¼šç”¨æˆ·åæˆ–å¯†ç é”™è¯¯', { 
                    username: username,
                    operation: 'ç”¨æˆ·ç™»å½•å¤±è´¥'
                });
                alert('ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯');
            }
        }

        // å¤„ç†æ³¨å†Œ
        async function handleRegister() {
            const username = document.getElementById('register-username').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value.trim();

            logger.info('ç”¨æˆ·å°è¯•æ³¨å†Œ', { 
                username: username,
                email: email,
                operation: 'ç”¨æˆ·æ³¨å†Œå°è¯•'
            });

            if (!username || !email || !password) {
                logger.warn('æ³¨å†Œå¤±è´¥ï¼šç¼ºå°‘å¿…å¡«å­—æ®µ', { username: username, email: email });
                alert('è¯·å¡«å†™æ‰€æœ‰å­—æ®µ');
                return;
            }

            if (password.length < 6) {
                logger.warn('æ³¨å†Œå¤±è´¥ï¼šå¯†ç è¿‡çŸ­', { username: username, passwordLength: password.length });
                alert('å¯†ç è‡³å°‘éœ€è¦6ä¸ªå­—ç¬¦');
                return;
            }

            // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
            if (cloudData.users.some(u => u.username === username)) {
                logger.warn('æ³¨å†Œå¤±è´¥ï¼šç”¨æˆ·åå·²å­˜åœ¨', { username: username });
                alert('ç”¨æˆ·åå·²å­˜åœ¨');
                return;
            }

            // æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
            if (cloudData.users.some(u => u.email === email)) {
                logger.warn('æ³¨å†Œå¤±è´¥ï¼šé‚®ç®±å·²å­˜åœ¨', { username: username, email: email });
                alert('é‚®ç®±å·²å­˜åœ¨');
                return;
            }

            let newUser;
            try {
                newUser = {
                    id: Date.now(),
                    username,
                    email,
                    password,
                    createdAt: new Date().toISOString()
                };

                // æ·»åŠ ç”¨æˆ·åˆ°æœ¬åœ°æ•°æ®
                cloudData.users.push(newUser);
                
                logger.info('ç”¨æˆ·æ³¨å†ŒæˆåŠŸ', { 
                    userId: newUser.id,
                    username: newUser.username,
                    email: newUser.email,
                    operation: 'ç”¨æˆ·æ³¨å†ŒæˆåŠŸ'
                });
                
                // ç«‹å³è®¾ç½®å½“å‰ç”¨æˆ·å’Œæœ¬åœ°å­˜å‚¨ï¼ˆç¡®ä¿å³ä½¿åŒæ­¥å¤±è´¥ä¹Ÿèƒ½ä¿æŒç™»å½•çŠ¶æ€ï¼‰
                currentUser = newUser;
                localStorage.setItem('currentUser', JSON.stringify(newUser));
                showUserNav();
                closeModal('register-modal');
                updateStats();

                // å°è¯•åŒæ­¥åˆ°äº‘ç«¯ï¼Œä½†ä¸é˜»å¡ç”¨æˆ·ä½“éªŒ
                updateStatus('â˜ï¸ æ­£åœ¨ä¿å­˜ç”¨æˆ·æ•°æ®...', 'syncing');
                
                try {
                    await syncData();
                    alert('æ³¨å†ŒæˆåŠŸï¼ç”¨æˆ·æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯');
                } catch (syncError) {
                    console.error('ç”¨æˆ·æ•°æ®åŒæ­¥å¤±è´¥:', syncError);
                    alert('æ³¨å†ŒæˆåŠŸï¼ä½†æ•°æ®åŒæ­¥å¤±è´¥ï¼Œæ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°ã€‚è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚');
                    updateStatus('âš ï¸ æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°', 'error');
                    
                    // è®¾ç½®å®šæ—¶é‡è¯•åŒæ­¥
                    setTimeout(async () => {
                        try {
                            await syncData();
                            updateStatus('â˜ï¸ æ•°æ®åŒæ­¥æˆåŠŸ', 'connected');
                        } catch (retryError) {
                            console.error('é‡è¯•åŒæ­¥å¤±è´¥:', retryError);
                        }
                    }, 5000); // 5ç§’åé‡è¯•
                }

            } catch (error) {
                // ç§»é™¤å·²æ·»åŠ çš„ç”¨æˆ·æ•°æ®ï¼ˆå¦‚æœæ·»åŠ å¤±è´¥ï¼‰
                cloudData.users = cloudData.users.filter(u => u.id !== newUser?.id);
                alert('æ³¨å†Œå¤±è´¥: ' + error.message);
            }
        }

        // å¤„ç†å‘å¸ƒ/ç¼–è¾‘åº”ç”¨
        async function handleSaveApp() {
            const name = document.getElementById('app-name').value.trim();
            const url = document.getElementById('app-url').value.trim();
            const description = document.getElementById('app-description').value.trim();
            const category = document.getElementById('app-category').value;

            if (!name || !url || !description) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…éœ€å­—æ®µ');
                return;
            }

            // è®°å½•åº”ç”¨ä¿å­˜æ“ä½œå¼€å§‹
            const operationType = currentEditingAppId ? 'ç¼–è¾‘åº”ç”¨' : 'å‘å¸ƒæ–°åº”ç”¨';
            logger.info(`${operationType}æ“ä½œå¼€å§‹`, {
                appId: currentEditingAppId,
                appName: name,
                appUrl: url,
                category: category,
                operation: operationType
            });

            // è·å–æˆªå›¾æ•°æ®
            const previewImg = document.querySelector('#screenshot-preview img');
            let screenshot = '';
            
            if (previewImg) {
                // åªä½¿ç”¨ data-url å±æ€§ï¼Œç¡®ä¿åªå­˜å‚¨URL
                const urlData = previewImg.getAttribute('data-url');
                const base64Data = previewImg.getAttribute('data-base64');
                
                if (urlData) {
                    screenshot = urlData;
                    logger.info('ä½¿ç”¨å·²ä¸Šä¼ çš„æˆªå›¾URL', { screenshotUrl: urlData, source: 'å¤–éƒ¨å­˜å‚¨' });
                } else if (base64Data) {
                    // å¦‚æœå­˜åœ¨Base64æ•°æ®ï¼Œå…ˆä¸Šä¼ åè·å–URL
                    logger.info('æ£€æµ‹åˆ°Base64æˆªå›¾æ•°æ®ï¼Œå¼€å§‹ä¸Šä¼ ', { source: 'Base64è½¬æ¢' });
                    try {
                        screenshot = await uploadImageToStorage(base64Data, true);
                        logger.info('Base64æˆªå›¾ä¸Šä¼ æˆåŠŸ', { screenshotUrl: screenshot });
                    } catch (error) {
                        logger.error('Base64æˆªå›¾ä¸Šä¼ å¤±è´¥', { error: error.message });
                        console.error('ä¸Šä¼ æˆªå›¾å¤±è´¥:', error);
                        alert('æˆªå›¾ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡æ–°é€‰æ‹©æˆªå›¾');
                        return;
                    }
                }
            }
            
            // è®°å½•æˆªå›¾æ¥æºä¿¡æ¯
            const screenshotSource = previewImg ? 
                (previewImg.getAttribute('data-url') ? 'å¤–éƒ¨å­˜å‚¨URL' : 
                 previewImg.getAttribute('data-base64') ? 'APIç”Ÿæˆæˆªå›¾' : 'æ— æˆªå›¾') : 'æ— æˆªå›¾';
            logger.info('æˆªå›¾ä¿¡æ¯ç¡®è®¤', { 
                hasScreenshot: !!screenshot, 
                source: screenshotSource,
                screenshotUrl: screenshot ? screenshot.substring(0, 100) + '...' : null 
            });
            
            try {
                if (currentEditingAppId) {
                    // ç¼–è¾‘æ¨¡å¼
                    const app = cloudData.apps.find(a => a.id === currentEditingAppId);
                    if (app) {
                        app.name = name;
                        app.description = description;
                        app.category = category;
                        app.screenshot = screenshot;
                    }
                } else {
                    // å‘å¸ƒæ–°åº”ç”¨æ¨¡å¼
                    const newApp = {
                        id: Date.now(),
                        name,
                        url,
                        description,
                        category,
                        author: currentUser.username,
                        authorId: currentUser.id,
                        screenshot,
                        likes: [],
                        favorites: [],
                        comments: [],
                        createdAt: new Date().toISOString()
                    };
                    cloudData.apps.push(newApp);
                }

                // å…ˆæ›´æ–°UIï¼Œç¡®ä¿ç”¨æˆ·èƒ½ç«‹å³çœ‹åˆ°å˜åŒ–
                closeModal('publish-modal');
                updateStats();
                loadApps();

                // ç„¶ååŒæ­¥åˆ°äº‘ç«¯
                updateStatus('â˜ï¸ æ­£åœ¨ä¿å­˜æ•°æ®...', 'syncing');
                
                try {
                    await syncData();
                    alert(currentEditingAppId ? 'åº”ç”¨æ›´æ–°æˆåŠŸï¼æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯' : 'åº”ç”¨å‘å¸ƒæˆåŠŸï¼æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯');
                } catch (syncError) {
                    console.error('æ•°æ®åŒæ­¥å¤±è´¥:', syncError);
                    alert((currentEditingAppId ? 'åº”ç”¨å·²æ›´æ–°' : 'åº”ç”¨å·²å‘å¸ƒ') + 'ï¼Œä½†æ•°æ®åŒæ­¥å¤±è´¥ã€‚æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚');
                    updateStatus('âš ï¸ æ•°æ®ä»…ä¿å­˜åœ¨æœ¬åœ°', 'error');
                    
                    // è®¾ç½®å®šæ—¶é‡è¯•åŒæ­¥
                    setTimeout(async () => {
                        try {
                            await syncData();
                            updateStatus('â˜ï¸ æ•°æ®åŒæ­¥æˆåŠŸ', 'connected');
                        } catch (retryError) {
                            console.error('é‡è¯•åŒæ­¥å¤±è´¥:', retryError);
                        }
                    }, 5000);
                }

            } catch (error) {
                alert('æ“ä½œå¤±è´¥: ' + error.message);
            } finally {
                currentEditingAppId = null; // æ“ä½œå®Œæˆåé‡ç½®
            }
        }

        // ç»Ÿä¸€å›¾ç‰‡ä¸Šä¼ å¤„ç†å‡½æ•°
        async function uploadImageToStorage(imageData, isBase64 = false) {
            logger.info('å¼€å§‹å›¾ç‰‡ä¸Šä¼ å¤„ç†', { 
                dataType: isBase64 ? 'Base64' : 'URL',
                dataSize: imageData ? imageData.length : 0,
                operation: 'å›¾ç‰‡ä¸Šä¼ '
            });
            
            try {
                let base64Payload;
                
                if (isBase64) {
                    // å¦‚æœå·²ç»æ˜¯Base64ï¼Œæå–payloadéƒ¨åˆ†
                    if (imageData.startsWith('data:')) {
                        base64Payload = imageData.split(',')[1];
                    } else {
                        base64Payload = imageData;
                    }
                } else {
                    // å¦‚æœæ˜¯URLï¼Œå…ˆè½¬æ¢ä¸ºBase64
                    const response = await fetch(imageData);
                    const blob = await response.blob();
                    
                    return new Promise((resolve, reject) => {
                        const reader = new FileReader();
                        reader.onload = async function(e) {
                            base64Payload = e.target.result.split(',')[1];
                            
                            try {
                                const res = await fetch('/.netlify/functions/upload-image', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify({ image: base64Payload })
                                });
                                const result = await res.json();
                                if (!res.ok) throw new Error(result.error || 'Upload failed');
                                resolve(result.url);
                            } catch (err) {
                                reject(err);
                            }
                        };
                        reader.onerror = reject;
                        reader.readAsDataURL(blob);
                    });
                }
                
                // ä¸Šä¼ Base64æ•°æ®
                const res = await fetch('/.netlify/functions/upload-image', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: base64Payload })
                });
                const result = await res.json();
                if (!res.ok) throw new Error(result.error || 'Upload failed');
                
                logger.info('å›¾ç‰‡ä¸Šä¼ æˆåŠŸ', { 
                    uploadedUrl: result.url,
                    operation: 'å›¾ç‰‡ä¸Šä¼ æˆåŠŸ'
                });
                return result.url;
            } catch (error) {
                logger.error('å›¾ç‰‡ä¸Šä¼ å¤±è´¥', { 
                    error: error.message,
                    operation: 'å›¾ç‰‡ä¸Šä¼ å¤±è´¥'
                });
                console.error('ä¸Šä¼ å›¾ç‰‡å¤±è´¥:', error);
                throw error;
            }
        }

        // ç”Ÿæˆæˆªå›¾
        function generateScreenshot() {
            const url = document.getElementById('app-url').value.trim();
            if (!url) {
                alert('è¯·å…ˆå¡«å†™"ä½œå“é“¾æ¥"å­—æ®µï¼Œç„¶åå†ç”Ÿæˆæˆªå›¾');
                return;
            }

            // éªŒè¯URLæ ¼å¼
            try {
                new URL(url);
            } catch (e) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€é“¾æ¥ï¼ˆå¦‚ï¼šhttps://example.comï¼‰');
                return;
            }

            // è®°å½•æˆªå›¾APIè°ƒç”¨å¼€å§‹
            logger.info('å¼€å§‹è°ƒç”¨æˆªå›¾API', { 
                targetUrl: url, 
                timestamp: new Date().toISOString(),
                operation: 'è‡ªåŠ¨ç”Ÿæˆæˆªå›¾'
            });

            const preview = document.getElementById('screenshot-preview');
            preview.innerHTML = '<div class="loading"></div><span style="margin-left: 10px;">æ­£åœ¨ç”Ÿæˆæˆªå›¾...</span>';

            // ä½¿ç”¨å¤šä¸ªå¤‡ç”¨æˆªå›¾æœåŠ¡
            const screenshotServices = [
                `/.netlify/functions/screenshot-proxy?url=${encodeURIComponent(url)}`,
                `https://image.thum.io/get/width/1200/crop/800/noanimate/${encodeURIComponent(url)}`,
                `https://mini.s-shot.ru/1200x800/PNG/?${encodeURIComponent(url)}`
            ];

            let currentServiceIndex = 0;

            function tryNextService() {
                if (currentServiceIndex >= screenshotServices.length) {
                    logger.error('æ‰€æœ‰æˆªå›¾æœåŠ¡éƒ½å¤±è´¥', { 
                        targetUrl: url, 
                        attemptedServices: screenshotServices.length,
                        operation: 'æˆªå›¾APIè°ƒç”¨å¤±è´¥'
                    });
                    preview.innerHTML = '<div class="placeholder"><div style="font-size: 2rem;">âŒ</div><div>æˆªå›¾ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ‰‹åŠ¨ä¸Šä¼ å›¾ç‰‡</div></div>';
                    return;
                }

                const screenshotUrl = screenshotServices[currentServiceIndex];
                logger.info(`å°è¯•æˆªå›¾æœåŠ¡ ${currentServiceIndex + 1}`, { 
                    service: screenshotUrl, 
                    serviceIndex: currentServiceIndex,
                    operation: 'æˆªå›¾æœåŠ¡è°ƒç”¨'
                });
                const img = new Image();
                
                img.onload = function() {
                    preview.innerHTML = `<img src="${screenshotUrl}" alt="ç½‘ç«™æˆªå›¾">`;
                    
                    // æ˜¾ç¤ºè½¬æ¢çŠ¶æ€
                    const statusDiv = document.createElement('div');
                    statusDiv.style.cssText = 'position: absolute; bottom: 8px; left: 8px; background: rgba(255,149,0,0.9); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;';
                    statusDiv.textContent = 'æ­£åœ¨ä¼˜åŒ–æˆªå›¾...';
                    preview.style.position = 'relative';
                    preview.appendChild(statusDiv);
                    
                    // ä¸Šä¼ æˆªå›¾åˆ°å¤–éƒ¨å­˜å‚¨
                    uploadImageToStorage(screenshotUrl, false).then(function(uploadedUrl) {
                        // ç§»é™¤çŠ¶æ€æç¤º
                        if (statusDiv.parentNode) {
                            statusDiv.remove();
                        }
                        
                        if (uploadedUrl) {
                            // å¦‚æœä¸Šä¼ æˆåŠŸï¼Œè®¾ç½®URL
                            logger.info('æˆªå›¾ç”Ÿæˆå¹¶ä¸Šä¼ æˆåŠŸ', { 
                                service: screenshotUrl, 
                                serviceIndex: currentServiceIndex,
                                uploadedUrl: uploadedUrl,
                                operation: 'æˆªå›¾APIæˆåŠŸ'
                            });
                            const previewImg = preview.querySelector('img');
                            if (previewImg) {
                                previewImg.setAttribute('data-url', uploadedUrl);
                                
                                // æ˜¾ç¤ºæˆåŠŸçŠ¶æ€
                                const successDiv = document.createElement('div');
                                successDiv.style.cssText = 'position: absolute; bottom: 8px; left: 8px; background: rgba(40,167,69,0.9); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;';
                                successDiv.textContent = 'âœ“ æˆªå›¾å·²å°±ç»ª';
                                preview.appendChild(successDiv);
                                
                                // 3ç§’åç§»é™¤æˆåŠŸæç¤º
                                setTimeout(() => {
                                    if (successDiv.parentNode) {
                                        successDiv.remove();
                                    }
                                }, 3000);
                            }
                        } else {
                            // ä¸Šä¼ å¤±è´¥çš„æç¤º
                            logger.warn('æˆªå›¾ç”ŸæˆæˆåŠŸä½†ä¸Šä¼ å¤±è´¥', { 
                                service: screenshotUrl, 
                                serviceIndex: currentServiceIndex,
                                operation: 'æˆªå›¾ä¸Šä¼ å¤±è´¥'
                            });
                            const errorDiv = document.createElement('div');
                            errorDiv.style.cssText = 'position: absolute; bottom: 8px; left: 8px; background: rgba(220,53,69,0.9); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;';
                            errorDiv.textContent = 'âš  æˆªå›¾ä¸Šä¼ å¤±è´¥';
                            preview.appendChild(errorDiv);
                            
                            // 5ç§’åç§»é™¤é”™è¯¯æç¤º
                            setTimeout(() => {
                                if (errorDiv.parentNode) {
                                    errorDiv.remove();
                                }
                            }, 5000);
                        }
                    }).catch(function(error) {
                        // ç§»é™¤çŠ¶æ€æç¤º
                        if (statusDiv.parentNode) {
                            statusDiv.remove();
                        }
                        
                        logger.error('æˆªå›¾ä¸Šä¼ å¼‚å¸¸', { 
                            service: screenshotUrl, 
                            serviceIndex: currentServiceIndex,
                            error: error.message,
                            operation: 'æˆªå›¾ä¸Šä¼ å¼‚å¸¸'
                        });
                        console.error('æˆªå›¾ä¸Šä¼ å¤±è´¥:', error);
                        const errorDiv = document.createElement('div');
                        errorDiv.style.cssText = 'position: absolute; bottom: 8px; left: 8px; background: rgba(220,53,69,0.9); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;';
                        errorDiv.textContent = 'âš  æˆªå›¾ä¸Šä¼ å¤±è´¥';
                        preview.appendChild(errorDiv);
                        
                        // 5ç§’åç§»é™¤é”™è¯¯æç¤º
                        setTimeout(() => {
                            if (errorDiv.parentNode) {
                                errorDiv.remove();
                            }
                        }, 5000);
                    });
                };
                
                img.onerror = function() {
                    logger.warn(`æˆªå›¾æœåŠ¡ ${currentServiceIndex + 1} å¤±è´¥`, { 
                        service: screenshotUrl, 
                        serviceIndex: currentServiceIndex,
                        operation: 'æˆªå›¾æœåŠ¡å¤±è´¥',
                        nextAttempt: currentServiceIndex + 1 < screenshotServices.length
                    });
                    console.log(`æˆªå›¾æœåŠ¡ ${currentServiceIndex + 1} å¤±è´¥: ${screenshotUrl}`);
                    currentServiceIndex++;
                    setTimeout(tryNextService, 1000);
                };
                
                img.src = screenshotUrl;
            }

            setTimeout(tryNextService, 2000);
        }

        // åˆ‡æ¢æˆªå›¾æ–¹å¼
        function toggleScreenshotMethod() {
            const apiSection = document.getElementById('screenshot-api-section');
            const uploadSection = document.getElementById('screenshot-upload-section');
            const selectedMethod = document.querySelector('input[name="screenshot-method"]:checked').value;

            if (selectedMethod === 'api') {
                apiSection.style.display = 'block';
                uploadSection.style.display = 'none';
            } else {
                apiSection.style.display = 'none';
                uploadSection.style.display = 'block';
            }
        }

        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        async function handleImageUpload(input) {
            const file = input.files[0];
            if (!file) return;

            // è®°å½•æ‰‹åŠ¨ä¸Šä¼ å¼€å§‹
            logger.info('ç”¨æˆ·å¼€å§‹æ‰‹åŠ¨ä¸Šä¼ å›¾ç‰‡', { 
                fileName: file.name,
                fileSize: file.size,
                fileType: file.type,
                operation: 'æ‰‹åŠ¨ä¸Šä¼ å›¾ç‰‡'
            });

            if (!file.type.startsWith('image/')) {
                logger.warn('ç”¨æˆ·å°è¯•ä¸Šä¼ éå›¾ç‰‡æ–‡ä»¶', { fileName: file.name, fileType: file.type });
                alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶');
                return;
            }

            if (file.size > 10 * 1024 * 1024) { // 10MB åˆå§‹é™åˆ¶ï¼Œåç»­ä¼šè‡ªåŠ¨å‹ç¼©
                logger.warn('ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶è¿‡å¤§', { fileName: file.name, fileSize: file.size });
                alert('å›¾ç‰‡æ–‡ä»¶ä¸èƒ½è¶…è¿‡10MB');
                return;
            }
            
            const preview = document.getElementById('screenshot-preview');
            preview.innerHTML = '<div class="loading"></div><span style="margin-left: 10px;">æ­£åœ¨å‹ç¼©å›¾ç‰‡...</span>';

            const options = {
                maxSizeMB: 0.2, // å‹ç¼©åˆ°çº¦200KB
                maxWidthOrHeight: 1024,
                fileType: 'image/jpeg',
                useWebWorker: true,
                onProgress: (p) => {
                    const progressSpan = preview.querySelector('span');
                    if (progressSpan) {
                        progressSpan.textContent = `æ­£åœ¨å‹ç¼©å›¾ç‰‡... ${p}%`;
                    }
                },
            };

            try {
                const compressedFile = await imageCompression(file, options);
                
                logger.info('å›¾ç‰‡å‹ç¼©æˆåŠŸ', { 
                    originalSize: file.size,
                    compressedSize: compressedFile.size,
                    compressionRatio: Math.round((1 - compressedFile.size / file.size) * 100),
                    operation: 'å›¾ç‰‡å‹ç¼©æˆåŠŸ'
                });
                
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const base64DataFull = e.target.result;
                    const base64Payload = base64DataFull.split(',')[1];

                    preview.innerHTML = '<div class="loading"></div><span style="margin-left: 10px;">æ­£åœ¨ä¸Šä¼ å›¾ç‰‡...</span>';

                    try {
                        const res = await fetch('/.netlify/functions/upload-image', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ image: base64Payload })
                        });
                        const result = await res.json();
                        if (!res.ok) throw new Error(result.error || 'Upload failed');

                        const imgUrl = result.url;
                        logger.info('æ‰‹åŠ¨ä¸Šä¼ å›¾ç‰‡æˆåŠŸ', { 
                            uploadedUrl: imgUrl,
                            finalSize: compressedFile.size,
                            operation: 'æ‰‹åŠ¨ä¸Šä¼ æˆåŠŸ'
                        });
                        const img = `<img src="${imgUrl}" alt="ä¸Šä¼ çš„æˆªå›¾" data-url="${imgUrl}">`;
                        preview.innerHTML = img;

                    } catch (err) {
                        logger.error('æ‰‹åŠ¨ä¸Šä¼ å›¾ç‰‡å¤±è´¥', { 
                            error: err.message,
                            operation: 'æ‰‹åŠ¨ä¸Šä¼ å¤±è´¥'
                        });
                        console.error(err);
                        alert('å›¾ç‰‡ä¸Šä¼ å¤±è´¥');
                        preview.innerHTML = '<div class="placeholder"><div style="font-size: 2rem;">âŒ</div><div>ä¸Šä¼ å¤±è´¥</div></div>';
                    }
                };
                reader.readAsDataURL(compressedFile);

            } catch (error) {
                console.error(error);
                alert('å›¾ç‰‡å‹ç¼©å¤±è´¥ï¼Œè¯·å°è¯•å…¶ä»–å›¾ç‰‡æˆ–æ¢ä¸ªæµè§ˆå™¨ã€‚');
                preview.innerHTML = '<div class="placeholder"><div style="font-size: 2rem;">âŒ</div><div>å‹ç¼©å¤±è´¥</div></div>';
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            logger.info('ç”¨æˆ·é€€å‡ºç™»å½•', { 
                userId: currentUser?.id,
                username: currentUser?.username,
                operation: 'ç”¨æˆ·é€€å‡ºç™»å½•'
            });
            
            localStorage.removeItem('currentUser');
            currentUser = null;
            showGuestNav();
            document.querySelector('.page-title').textContent = 'å‘ç°ç²¾å½©ä½œå“';
            loadApps();
        }

        // é‡ç½®æ‰€æœ‰æœç´¢æ¡ä»¶
        function resetSearchConditions() {
            // æ¡Œé¢ç«¯
            const searchInput = document.getElementById('search-input');
            const categoryFilter = document.getElementById('category-filter');
            const sortFilter = document.getElementById('sort-filter');
            
            if (searchInput) searchInput.value = '';
            if (categoryFilter) categoryFilter.value = '';
            if (sortFilter) sortFilter.value = 'newest';
            
            // ç§»åŠ¨ç«¯
            const searchInputMobile = document.getElementById('search-input-mobile');
            const categoryFilterMobile = document.getElementById('category-filter-mobile');
            const sortFilterMobile = document.getElementById('sort-filter-mobile');
            
            if (searchInputMobile) searchInputMobile.value = '';
            if (categoryFilterMobile) categoryFilterMobile.value = '';
            if (sortFilterMobile) sortFilterMobile.value = 'newest';

            // é‡ç½®è‡ªå®šä¹‰ä¸‹æ‹‰èœå•çš„æ˜¾ç¤ºçŠ¶æ€
            updateDropdownSelection('category', '');
            updateDropdownSelection('sort', 'newest');
            updateDropdownSelection('category-mobile', '');
            updateDropdownSelection('sort-mobile', 'newest');
        }

        // è¿”å›é¦–é¡µ
        function goHome() {
            resetSearchConditions();
            loadApps();
        }

        // çª—å£å¤§å°æ”¹å˜æ—¶å¤„ç†
        window.addEventListener('resize', function() {
            if (window.innerWidth > 1024) {
                // æ¡Œé¢ç«¯æ¨¡å¼ä¸‹å…³é—­ç§»åŠ¨ç«¯èœå•
                closeMobileMenu();
            }
        });

        // é”®ç›˜äº‹ä»¶å¤„ç†
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeMobileMenu();
            }
        });

        // è‡ªå®šä¹‰ä¸‹æ‹‰èœå•åŠŸèƒ½
        function toggleDropdown(type) {
            const dropdown = document.getElementById(`${type}-dropdown`);
            const trigger = document.getElementById(`${type}-trigger`);
            const isShow = dropdown.classList.contains('show');
            
            // å…³é—­æ‰€æœ‰å…¶ä»–ä¸‹æ‹‰èœå•
            closeAllDropdowns();
            
            if (!isShow) {
                dropdown.classList.add('show');
                trigger.classList.add('active');
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶åˆ°ä¸‹æ‹‰èœå•é¡¹
                const items = dropdown.querySelectorAll('.dropdown-item');
                items.forEach(item => {
                    item.onclick = function() {
                        selectDropdownItem(type, this);
                    };
                });
            }
        }

        function selectDropdownItem(type, item) {
            const value = item.getAttribute('data-value');
            const dropdown = document.getElementById(`${type}-dropdown`);
            const trigger = document.getElementById(`${type}-trigger`);
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            dropdown.querySelectorAll('.dropdown-item').forEach(i => i.classList.remove('selected'));
            item.classList.add('selected');
            
            // æ›´æ–°éšè—çš„selectå€¼
            if (type.includes('category')) {
                const selectId = type.includes('mobile') ? 'category-filter-mobile' : 'category-filter';
                document.getElementById(selectId).value = value;
                
                // æ›´æ–°æŒ‰é’®å›¾æ ‡ï¼ˆå¯é€‰ï¼‰
                if (value) {
                    const emoji = item.textContent.split(' ')[0]; // è·å–emoji
                    trigger.textContent = emoji;
                } else {
                    trigger.textContent = 'ğŸ·ï¸';
                }
            } else if (type.includes('sort')) {
                const selectId = type.includes('mobile') ? 'sort-filter-mobile' : 'sort-filter';
                document.getElementById(selectId).value = value;
                
                // æ›´æ–°æŒ‰é’®å›¾æ ‡
                if (value === 'newest' || value === 'oldest') {
                    trigger.textContent = 'ğŸ“…';
                } else if (value === 'name') {
                    trigger.textContent = 'ğŸ”¤';
                } else if (value === 'author') {
                    trigger.textContent = 'ğŸ‘¤';
                }
            }
            
            // å…³é—­ä¸‹æ‹‰èœå•
            dropdown.classList.remove('show');
            trigger.classList.remove('active');
            
            // è§¦å‘æœç´¢
            searchApps();
        }

        function closeAllDropdowns() {
            const dropdowns = document.querySelectorAll('.dropdown-menu');
            const triggers = document.querySelectorAll('.dropdown-trigger');
            
            dropdowns.forEach(dropdown => dropdown.classList.remove('show'));
            triggers.forEach(trigger => trigger.classList.remove('active'));
        }

        // ç‚¹å‡»å¤–éƒ¨å…³é—­ä¸‹æ‹‰èœå•
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.custom-dropdown')) {
                closeAllDropdowns();
            }
        });

        // åŒæ­¥æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯çš„ç­›é€‰å™¨é€‰æ‹©
        function syncCustomDropdowns() {
            // åŒæ­¥åˆ†ç±»é€‰æ‹©
            const categoryDesktop = document.getElementById('category-filter').value;
            const categoryMobile = document.getElementById('category-filter-mobile').value;
            
            if (categoryDesktop !== categoryMobile) {
                // æ›´æ–°ç§»åŠ¨ç«¯
                updateDropdownSelection('category-mobile', categoryDesktop);
                document.getElementById('category-filter-mobile').value = categoryDesktop;
            }
            
            // åŒæ­¥æ’åºé€‰æ‹©
            const sortDesktop = document.getElementById('sort-filter').value;
            const sortMobile = document.getElementById('sort-filter-mobile').value;
            
            if (sortDesktop !== sortMobile) {
                // æ›´æ–°ç§»åŠ¨ç«¯
                updateDropdownSelection('sort-mobile', sortDesktop);
                document.getElementById('sort-filter-mobile').value = sortDesktop;
            }
        }

        function updateDropdownSelection(type, value) {
            const dropdown = document.getElementById(`${type}-dropdown`);
            const trigger = document.getElementById(`${type}-trigger`);
            
            if (!dropdown || !trigger) return;
            
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            dropdown.querySelectorAll('.dropdown-item').forEach(i => {
                i.classList.remove('selected');
                if (i.getAttribute('data-value') === value) {
                    i.classList.add('selected');
                    
                    // æ›´æ–°æŒ‰é’®å›¾æ ‡
                    if (type.includes('category')) {
                        if (value) {
                            const emoji = i.textContent.split(' ')[0];
                            trigger.textContent = emoji;
                        } else {
                            trigger.textContent = 'ğŸ·ï¸';
                        }
                    } else if (type.includes('sort')) {
                        if (value === 'newest' || value === 'oldest') {
                            trigger.textContent = 'ğŸ“…';
                        } else if (value === 'name') {
                            trigger.textContent = 'ğŸ”¤';
                        } else if (value === 'author') {
                            trigger.textContent = 'ğŸ‘¤';
                        }
                    }
                }
            });
        }

        // æ—¥å¿—æŸ¥çœ‹åŠŸèƒ½
        function showLogViewer() {
            // åªæœ‰ç®¡ç†å‘˜æˆ–å¼€å‘è€…å¯ä»¥æŸ¥çœ‹æ—¥å¿—ï¼ˆè¿™é‡Œç®€åŒ–ä¸ºç”¨æˆ·IDä¸º1çš„ç”¨æˆ·ï¼‰
            if (!currentUser || currentUser.id !== 1) {
                alert('æ‚¨æ²¡æœ‰æƒé™æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—');
                return;
            }
            
            showModal('log-viewer-modal');
            refreshLogs();
        }

        function refreshLogs() {
            const levelFilter = document.getElementById('log-level-filter').value;
            const usernameFilter = document.getElementById('log-username-filter').value.trim();
            const logContent = document.getElementById('log-content');
            
            const logs = logger.getLogs(200, levelFilter || null, usernameFilter || null);
            
            if (logs.length === 0) {
                logContent.innerHTML = '<div style="text-align: center; color: #666; padding: 2rem;">æš‚æ— æ—¥å¿—è®°å½•</div>';
                return;
            }
            
            const logHtml = logs.map(log => {
                const levelColor = {
                    'INFO': '#28a745',
                    'WARN': '#ffc107', 
                    'ERROR': '#dc3545'
                }[log.level] || '#6c757d';
                
                const timeStr = new Date(log.timestamp).toLocaleString('zh-CN');
                const dataStr = log.data ? JSON.stringify(log.data, null, 2) : '';
                
                return `
                    <div style="margin-bottom: 1rem; padding: 0.5rem; border-left: 4px solid ${levelColor}; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem;">
                            <span style="font-weight: bold; color: ${levelColor};">[${log.level}]</span>
                            <span style="color: #666; font-size: 0.8rem;">${timeStr}</span>
                        </div>
                        <div style="margin-bottom: 0.25rem;">
                            <strong>ç”¨æˆ·:</strong> ${log.user.username} (ID: ${log.user.id})
                        </div>
                        <div style="margin-bottom: 0.25rem;">
                            <strong>æ¶ˆæ¯:</strong> ${log.message}
                        </div>
                        ${dataStr ? `<details style="margin-top: 0.5rem;"><summary style="cursor: pointer; color: #007bff;">æŸ¥çœ‹è¯¦ç»†æ•°æ®</summary><pre style="margin: 0.5rem 0; padding: 0.5rem; background: #f8f9fa; border-radius: 4px; overflow-x: auto;">${dataStr}</pre></details>` : ''}
                    </div>
                `;
            }).join('');
            
            logContent.innerHTML = logHtml;
        }

        function clearLogs() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ—¥å¿—å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                logger.clearLogs();
                refreshLogs();
                alert('æ—¥å¿—å·²æ¸…ç©º');
            }
        }

        function exportLogs() {
            const logs = logger.getLogs(1000);
            const logText = logs.map(log => {
                const timeStr = new Date(log.timestamp).toISOString();
                const dataStr = log.data ? JSON.stringify(log.data) : '';
                return `[${timeStr}] [${log.level}] ${log.user.username}: ${log.message} ${dataStr}`;
            }).join('\n');
            
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bee-store-logs-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æ˜¾ç¤ºæ—¥å¿—æŸ¥çœ‹æŒ‰é’®ï¼ˆä»…ç®¡ç†å‘˜ï¼‰
        function updateLogViewerVisibility() {
            const showLogBtn = currentUser && currentUser.id === 1;
            const logBtn = document.getElementById('log-viewer-btn');
            const mobileLogBtn = document.getElementById('mobile-log-viewer-btn');
            
            if (logBtn) logBtn.style.display = showLogBtn ? 'inline-block' : 'none';
            if (mobileLogBtn) mobileLogBtn.style.display = showLogBtn ? 'block' : 'none';
        }

        // ä¿®æ”¹showUserNavå‡½æ•°ä»¥åŒ…å«æ—¥å¿—æŒ‰é’®å¯è§æ€§æ›´æ–°
        const originalShowUserNav = showUserNav;
        showUserNav = function() {
            originalShowUserNav();
            updateLogViewerVisibility();
        };

        const originalShowGuestNav = showGuestNav;
        showGuestNav = function() {
            originalShowGuestNav();
            updateLogViewerVisibility();
        };

        // åˆå§‹åŒ–åº”ç”¨
        init();
    </script>
</body>
</html>

